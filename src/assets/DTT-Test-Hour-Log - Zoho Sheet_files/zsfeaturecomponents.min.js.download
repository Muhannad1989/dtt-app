var FComponents=function(e){var o={suite:"Zoho",webFontsHostName:location.protocol+"//webfonts.zohostatic.eu/",csrfParamName:"fccsrf",csrfCookieName:"FC_CSRF_TOKEN",csrfRequestURL:void 0,contextPath:"fcomponents/",clientTokenIsEnabled:!1,clientTokenName:"x-uds-clitoken",clientTokenServiceParamName:"x-cli-service-name",serviceName:"ZohoWriter",clientTokenReqURL:"https://accounts.localzoho.com/login",clientTokenServiceURL:"tokenpair.do",service:"WR"},t=void 0;function r(r){o.serviceName=r.serviceName,o.domain=r.domain;var i=o.clientTokenServiceURL;if("tokenpair.do"===i){var n=window.location;i=n.protocol+"//"+n.hostname+FComponents.option("contextPath")+i}var s=r.clientTokenReqURL+"client_auth=true&servicename="+r.serviceName+"&serviceurl="+i,a=e("<iframe>").attr({id:"zfc-iam-clienttoken",src:s,style:"display:none;"});a.appendTo("body"),a.load(function(){var e;(e=this.contentWindow.location.href)&&(t=e.split("#")[1])&&(t=t.split("=")[1],document.cookie=o.clientTokenName+"="+t+"; domain="+o.domain+"; path=/; secure")})}return{getClientToken:function(e){return t},init:function(t){var i=window.location.hostname.split(".");i.length>2&&(i.reverse().pop(),i.reverse()),o.domain=i.join(".");var n=!1;void 0!==t.csrfRequestURL&&""!==t.csrfRequestURL&&FCUtil.ajaxUtil(t.csrfRequestURL,"GET"),!t.csrfInitRequest||void 0!==t.csrfParamName&&""!==t.csrfParamName||(n=!0,t.csrfParamName=o.csrfParamName,t.csrfCookieName=o.csrfCookieName);var s=(o=e.extend({},o,t)).clientToken;!0!==o.clientTokenIsEnabled||void 0!==s&&""!==s||FCUtil.ajaxUtil("getproperties.do","get","",{success:function(e){"success"===e.request&&r(e)}}),n&&FCUtil.ajaxUtil("html/blank.html","get","","")},option:function(e,t){if(!t)return o[e];o[e]=t},getDriveInfo:function(e){var t=(e=e||{}).product_type||o.product_type,r=e.owner_id||o.owner_id;return t&&r?"?product_type="+t+"&owner_id="+r:""},setI18NKeys:function(e){var o={};for(var t in e){var r=t.split("."),i=r[1],n=r.slice(2).join(".");o[i]||(o[i]={}),o[i][n]=e[t]}ZComponents.setI18NKeys(o)}}}(jQuery),FCUtil=function(e){function o(e){for(var o=e+"=",t=document.cookie.split(";"),r=0;r<t.length;r++){var i=t[r].trim();if(0===i.indexOf(o))return i.substring(o.length,i.length)}return""}return{ajaxUtil:function(o,t,r,i,n,s){return r=r||{},n=n||{},i=i||{},n.responseType=n.responseType?n.responseType:"application/json","post"===t.toLowerCase()&&(r[FComponents.option("csrfParamName")]=this.getCSRFToken()),o=s?o:FComponents.option("contextPath")+o,i.errorNotified=!1,e.ajax({type:t,url:o,data:r,beforeSend:function(e){i.progress&&i.progress(e)},fail:function(e){i.fail&&!i.errorNotified&&(i.errorNotified=!0,i.fail(e))},error:function(e){i.fail&&!i.errorNotified&&(i.errorNotified=!0,i.fail(e))},success:function(o){if(i.success){var t=o;"object"!=typeof t&&"application/json"===n.responseType&&(t=e.parseJSON(o)),i.success(t)}}})},commonKeys:{insert:"Insert",close:"Close",cancel:"Cancel"},getString:function(e,o,t){return this.getI18NString("fcommon",e,t,o||this.commonKeys)},getI18NString:function(e,o,t,r){return t=t||[],ZComponents.getI18NText(e,o,r,t)},removeProgressDialog:function(o,t){e("#zfc-progress-dialog").remove()},showProgressDialog:function(o,t,r){if(!0===r){(r=e("<div>").attr({id:"zfc-progress-dialog-overlay"}).appendTo("body")).css({overflow:"scroll",position:"fixed",width:"100%",height:"100%","z-index":e.ui.dialog&&e.ui.dialog.zIndex?e.ui.dialog.zIndex:1e4,top:0,left:0});var i=e("<div>").attr({id:"zfc-progress-dialog"}).appendTo(r)}else i=e("<div>").attr({id:"zfc-progress-dialog"}).appendTo("body");i.css({height:t.outerHeight(),width:t.outerWidth(),left:t.offset().left,top:t.offset().top});var n=e("<span>").attr({id:"zfc-dialog-loader",class:"ui-zfc-loader-circle"}).appendTo(i),s=e("<span>").attr({class:"zfc-dialog-loader-msg"}).appendTo(i);s.text(o),i.animate({height:110,width:220,marginTop:100,marginLeft:t.outerWidth()/3},100,function(){var e=(i.outerWidth()-(n.outerWidth()+s.width()+4))/2,o=(i.outerHeight()-n.outerHeight()-2)/2;n.css({left:e,top:o}),s.css({left:e,top:o}),n.fadeIn(50),s.fadeIn(100)})},showError:function(o,t,r,i,n){o=""===o||void 0===o?FCUtil.getString("internalserver.label"):o;var s=t.find("#ui-fc-server-error");s.length||(s=e('<div id="ui-fc-server-error" class="ui-fc-server-error"><div class="zc-server-error"><span id="zc-server-error-close" title="'+FCUtil.getString("close","fcommon")+'" class="ui-zfc-icon ui-icon-closethick"></span><div class="zc-server-error-msg" id="zfc-server-error"></div> </div> </div>'))[void 0!==n?n:"insertBefore"](r),s.find("#zfc-server-error").text(o);if(i=e.extend({},{openDelay:200,closeDelay:200},i),s.slideDown(i.openDelay,function(){i.onOpen&&i.onOpen(s)}),i.autoCloseDelay){t.data("zfcAutoClose")&&clearTimeout(t.data("zfcAutoClose"));var a=setTimeout(function(){s.slideUp(i.closeDelay,function(){i.onAutoClose&&i.onAutoClose(s)})},i.autoCloseDelay);t.data("zfcAutoClose",a)}s.find("#zc-server-error-close").off("click").on("click",function(e){i.beforeClose&&i.beforeClose(s),s.slideUp(i.closeDelay,function(){i.onClose&&i.onClose(s)})})},getCSRFToken:function(){return o(FComponents.option("csrfCookieName"))},getCSRFCookie:function(e){return o(e)}}}(jQuery);var NotifyCollaborator=function(e){var t={widgetEventPrefix:"notifycollaborator",_EVENTS:{ONOPEN:"open",ONSEND:"send",ONCLOSE:"close"},options:{fileId:void 0,isOwner:!1,isCoowner:!1,allowNewValues:!1,customShareTypeFilters:{}},_sharedTypes:{all:"allcollaborators.label",selected:"selectedrecipients.label",ownerandcoowner:"ownerandcoowner.label",owneronly:"owneronly.label"},_currentlySharedTypes:[],_userDetails:[],_create:function(t){if("string"==typeof t){var i=t;(t={}).fileId=i}this.options=e.extend({},this.options,t),this._isMenuSelect=!1,this._defaultCheck=!1;var n=e("<input>").hide().appendTo(e("body"));this._isPlaceholder=void 0===n[0].placeholder||null===n[0].placeholder,n.remove(),this.options.keys&&(this.keys=e.extend({},this.keys,this.options.keys)),this._createMainContainer(),this._defaultCheck||this._getSharedUserList(this.options.fileId);var s=this;this.message.on("keydown."+this.widgetName,function(e){13!==e.keyCode||!0!==e.ctrlKey&&!0!==e.metaKey||s._submit()})},_getDriveInfo:function(){return FComponents.getDriveInfo(this.options)},_getSharedUserList:function(t){var i={rid:this.options.fileId},n=this,s={progress:function(e){n._gradientLoader.show(),n._disableContainer(!0)},success:function(t){if("object"==typeof t){n._userDetails=t.users;var i=void 0;n._contactsServerURL=t.contactsServerURL,e(n._userDetails).each(function(e){i=n._userDetails[e],n._userDetails[e].image=n._getImage(i.id,i.type)}),n._defaultCheck=!0,n._initUserMenu(),n._createTokens(),n._selectNotifyOption("all",!0),n._expandCollapseEnable=!0,n._expandCollapse(),n._setMorePosition()}else n._showError(n._getString("unknownerror.label"),!0),e("#ui-znc-send").zbutton("setAttribute",{disabled:!0,text:n._getString("send.label","fcommon")});n._gradientLoader.hide(),n._disableContainer(!1)},fail:function(t){n._gradientLoader.hide(),n._disableContainer(!1),e("#ui-znc-send").zbutton("setAttribute",{disabled:!0,text:n._getString("send.label","fcommon")}),n._showError(n._getString("unknownerror.label"),!0)}};this.options.fileId?FCUtil.ajaxUtil("getsharedusers.do"+this._getDriveInfo(),"GET",i,s):n.options.users?(n._userDetails=n.options.users,n._gradientLoader.show(),n._disableContainer(!0),window.clearTimeout(this._demointerval),this._demointerval=setTimeout(function(){n._gradientLoader.hide(),n._disableContainer(!1),n._initUserMenu(),n._createTokens(),n._selectNotifyOption("all"),n._expandCollapseEnable=!0,n._expandCollapse(),n._setMorePosition()},3e3)):(n._gradientLoader.show(),n._disableContainer(!0),window.clearTimeout(this._demointerval),this._demointerval=setTimeout(function(){n._gradientLoader.hide(),n._disableContainer(!1),n._showError(n._getString("unknownerror.label"),!0),e("#ui-znc-send").zbutton("setAttribute",{disabled:!0,text:n._getString("send.label")})},3e3))},_createMainContainer:function(){this.element=e("<div>").attr("id","znotifycollaborator"),this.element.appendTo(e("body")),this._createDialog()},_createDialog:function(){var e,t=this;this.element.zdialog({type:"modal",minimizable:!1,className:"ui-znotify-collaborator",position:"center",width:600,resizable:{container:"window",minHeight:500,minWidth:600},buttons:[{text:t._getString("cancel.label","fcommon"),action:"CLOSE",id:"ui-znc-close"},{disabled:!0,text:t._getString("send.label","fcommon"),id:"ui-znc-send",action:t._submit.bind(t),appearance:"primary"}],title:t._getString("title.label"),resizestart:function(){e=t.element.height()},resize:function(){var i=(void 0).height()-t.element.height();t._dialogHeightDiff===i?(t._expandCollapseEnable&&t._more.trigger("click"),t._resizeContainer(),t._resizeTextArea()):(e=(void 0).height()-t._dialogHeightDiff,t.element.height(e),t._resizeContainer(),t._resizeTextArea(),t._dialogHeightDiff=i)},open:function(e){t._triggerEvent(t._EVENTS.ONOPEN,t.option)},resizeend:function(){t.element.height("")},close:function(){t._close()}}),this._form=this.element.find(".zdialog__content");var i=this.element.find(".zdialog__footer"),n='<div id="znc-sendmeacopy" class="zcheckbox"><input type="checkbox" id="ui-znc-sendmeacopy" class="zcheckbox__helper"/><label for="ui-znc-sendmeacopy" class="zcheckbox__label"><span class="zcheckbox__text">'+this._getString("sendmeacopy.label")+"</span></label></div>";i.prepend(n),this.element.on("zdialogminimize",function(){NotifyCollaborator.isMinimized=!0}),this.element.on("zdialogrestore",function(){NotifyCollaborator.isMinimized=!1}),this._initUserList()},_initUserList:function(){var t=this;this._prevValue="all";var i=e("<span>").attr({class:"ui-znc-recipients-label"}).text(this._getString("recipients.label")+":");this.zecContainer=e("<div>").attr({id:"ui-znc-container"}).append(i).appendTo(this._form),this._actionsBtn=e("<select>").attr({id:"ui-znc-combo","data-active-class":"is-selected","data-width":"auto",disabled:!0}).appendTo(this.zecContainer),this._actionsBtn.zselect({options:[{value:"all",id:"ui-znc-optionsall",label:this._getString("allcollaborators.label")}],change:function(i,n){if(n.fromUI){var s=n.value;"selected"===s?(t.zecRecipientsList.ztokenfield("removeAllTokens"),e("#ui-znc-send").zbutton("setAttribute",{disabled:!0,text:t._getString("send.label","fcommon")}),t._resizeTextArea()):s!=t._prevValue&&(t._selectNotifyOption(s),t._expandCollapseEnable&&t._more.trigger("click")),t._prevValue=s}}}),this.zecContainer.find(".zselectbox").on("mousedown",function(e){e.stopPropagation(),t.zecContainer.find(".zmenu--fortokenfield").hide()}),this._more=e("<div>").text("...").attr("id","ui-znc-recipients-list-more").addClass("ui-ztokens-token").appendTo(this.zecContainer),this._more.on("click",function(){e(this).hide(),t.zecRecipients.find(".ztokenfield__token").show(),t._expandCollapseEnable=!1,t._expandCollapse(!0),t.zecRecipients.find(".ztokenfield__textbox").show().focus()}),this._expandCollapseEnable=!0,this.zecRecipients=e('<div id="recipientlist" class="ztoken-container">').appendTo(this.zecContainer),this.zecRecipientsList=e("<div>").attr({id:"ui-znc-recipients-list",class:"ui-znc-collapse"}).appendTo(this.zecRecipients),this.zecRecipients.append(this._more),this._gradientLoader=e("<div>").attr({id:"zec-gradient-loader",class:"zfc-gradient-loader"}).appendTo(this.zecRecipients),this._createContents()},_initUserMenu:function(){var t=this;if(this._userDetails.length){var i,n={},s=this._sharedTypes;for(i in s)n[i]=s[i];for(i in s=this.options.customShareTypeFilters)n[i]=s[i];var o=coownerCheck=!1;e(this._userDetails).each(function(e){t._userDetails[e].permission.toLowerCase()===t._getString("owner.label")&&t.options.isOwner&&(o=!0),t._userDetails[e].permission.toLowerCase()!==t._getString("owner.label")&&t._userDetails[e].permission.toLowerCase()!==t._getString("coowner.label")||!t.options.isCoowner||(coownerCheck=!0)}),coownerCheck||delete n.ownerandcoowner,o||delete n.owneronly;var a=t._userDetails;for(i in a.sort(function(e,t){return e.name.toLowerCase()>t.name.toLowerCase()?1:e.name.toLowerCase()<t.name.toLowerCase()?-1:0}),s=[],n)s.push({value:i,label:this._getString(n[i])?this._getString(n[i]):n[i],id:"ui-znc-options"+i});this._actionsBtn.zselect("setAttribute","options",s),this._actionsBtn.zselect("setAttribute","selectedValue","all")}},_createTokens:function(){var t=this;this.zecRecipientsList.ztokenfield({data:this._userDetails||[],acceptNewValues:!0,dataValidation:!0,newValuePattern:this.options.allowNewValues,search:{by:"name",delay:1,minKeywordLength:0},messages:{noResults:t._getString("noresultsfound.label")},dropdownList:{contentType:"image-text-desc",position:"after-cursor",showNoResultsMessage:!0},dataMapping:{id:"id",value:"id",text:"name",informativeText:"email",image:"image",itemIdentifier:"email"},tokens:{contentType:"image-text",animateOnClose:!0},tokenremove:function(i,n){var s=t.zecRecipientsList.ztokenfield("getAllValues");t.zecRecipientsList.ztokenfield("hasInvalidTokens")||t._closeError(),!1===t._isMenuSelect&&"selected"!=t._actionsBtn.zselect("setAttribute","selectedValue")&&(t._actionsBtn.zselect("setAttribute","selectedValue","selected"),t._prevValue="selected"),s.length&&t._expandCollapseEnable&&t._more.trigger("click"),s.length||e("#ui-znc-send").zbutton("setAttribute",{disabled:!0,text:t._getString("send.label","fcommon")})},tokenaddfail:function(t,i){e("#ui-znc-send").zbutton("setAttribute","disabled",!1)},tokenadd:function(i,n){!1===t._isMenuSelect&&"selected"!=t._actionsBtn.zselect("setAttribute","selectedValue")&&(t._actionsBtn.zselect("setAttribute","selectedValue","selected"),t._prevValue="selected"),t._isMenuSelect=!1,e("#ui-znc-send").zbutton("setAttribute","disabled",!1)},remove:function(e,i){if(i.data){var n=t._selectedUserList.indexOf(i.data);t._selectedUserList.splice(n,1)}t._expandCollapse(!0),t.zecContainer.prepend(t._actionsBtn,t._more)}});var i=this.zecRecipientsList.ztokenfield("getElement");i.prepend(this.zecContainer.find(".zselectbox")),i.append(this._more),i.find(".zselectbox").on("mouseup",function(e){e.stopPropagation(),t.zecRecipientsList.ztokenfield("closeDropdownList")}).on("mousedown",function(e){e.stopPropagation(),t.zecRecipientsList.ztokenfield("closeDropdownList")}),this._actionsBtn.zselect("setAttribute","disabled",!1),this.zecRecipients.removeClass("ztoken-container")},_createContents:function(){var t=e("<div>").attr({id:"ui-znc-subject"});if(this.mailSubject=e("<input>").attr({class:"ztextbox",id:"ui-znc-mail-subject",autofocus:!0,type:"text",placeholder:this._getString("subject.label","fcommon"),data:'{"validateOptions":{"type":"nonEmpty","required":true}}'}).appendTo(t),this.zecContainer.append(t),this.message=e("<div>").attr({id:"ui-znc-message"}),this.mailMsg=e("<textarea>").attr({class:"ztextarea",id:"ui-znc-mail-message",placeholder:this._getString("message.label"),data:'{"validateOptions":{"type":"nonEmpty","required":true}}'}).appendTo(this.message),this.zecContainer.append(this.message),this._isPlaceholder){var i=e("<div>").addClass("ui-znc-placeholder").text(this._getString("subject.label","fcommon")).appendTo(t);this._placeHolder(this.mailSubject,i);var n=e("<div>").addClass("ui-znc-placeholder").text(this._getString("message.label")).appendTo(this.message);this._placeHolder(this.mailMsg,n)}this.element.zdialog("open"),this._dialogHeightDiff=this.element.parent().height()-this.element.height(),this.mailSubject.focus(),this._disableContainer(!0)},_submit:function(){if(this.zecRecipientsList.ztokenfield("hasInvalidTokens")||this.zecRecipients.find(".ztokenfield__textbox").val().length)e("#ui-znc-send").zbutton("setAttribute","disabled",!1),e("#ui-znc-send").zbutton("setAttribute","text",this._getString("send.label","fcommon"));else{this._closeError();var t=this.zecRecipientsList.ztokenfield("getAllValues"),i="",n=this;e(t).each(function(e){i=i+(void 0!==t[e].id?t[e].id:t[e].email)+","}).promise().done(function(){var e=n.mailSubject.val(),t=n.mailMsg.val();if(e.trim().length<1&&t.trim().length<1){var s=n._getString("sendmailwithoutsubject.label");ZComponents.ZAlertDialog?ZComponents.ZAlertDialog.open({type:"warning",primaryMessage:s,buttons:"yes-no",buttonsOrder:"mac",buttonsAlignment:"right",close:function(e,t){"YES"===(t=t.buttonOptions||{}).actionType&&n._sendNotifications(i)}}):confirm(s)&&n._sendNotifications(i)}else n._sendNotifications(i)})}},_disableContainer:function(e){this.mailSubject.attr("disabled",e),this.mailMsg.attr("disabled",e),this._actionsBtn.zselect("setAttribute","disabled",e)},_sendNotifications:function(t){var i=this,n=this.mailSubject.val(),s=ZComponents.encodeHTML(this.mailMsg.val()),o=this._actionsBtn.zselect("getAttribute","selectedValue");"selected"!==o&&(t=""),""===(n=n||"").length&&(n="  ");var a={rid:this.options.fileId,notifyto:o,recipients:t,subject:n,message:s,sendmeacopy:e("#ui-znc-sendmeacopy").is(":checked")};e("#ui-znc-send").zbutton("setAttribute",{disabled:!0,text:this._getString("sending.label","fcommon")}),i._disableContainer(!0),i.zecRecipientsList.ztokenfield("setAttribute","disabled",!0);var r={progress:function(t){e("#ui-znc-send").zbutton("setAttribute",{disabled:!0,label:i._getString("sending.label","fcommon")})},success:function(t){"success"===t.request?(ZAlertBanner.show({message:i._getString("sendmailsuccessfully.label"),target:e("body"),position:"absolute",closeButton:!0,type:"info",icon:"ui-components-icon ui-state-status-icon",hideDelay:1e3}),i.refresh(),i._triggerEvent(i._EVENTS.ONSEND,i),i.close()):i._handleMailFail(serverResponse)},fail:function(e){i._handleMailFail(e)}};FCUtil.ajaxUtil("sendnotifymails.do"+this._getDriveInfo(),"POST",a,r)},_handleMailFail:function(t){this._disableContainer(!1),this.zecRecipientsList.ztokenfield("setAttribute","disabled",!1),this._showError(this._getString("mail_fail_error.label")),e("#ui-znc-send").zbutton("setAttribute",{disabled:!1,text:this._getString("send.label","fcommon")})},refresh:function(){this._refresh()},_refresh:function(e){this._expandCollapseEnable=!0,this._expandCollapse(),this.mailSubject.val(""),this.mailMsg.val(""),e||(this._selectNotifyOption("all",!0),this._setMorePosition()),this._resizeTextArea(),this.zecRecipientsList.ztokenfield("setAttribute","disabled",!1)},_getImage:function(e,t){return"email"===(t=t&&t.toLowerCase()||"")&&(e="abcd",t=""),this._contactsServerURL+"/file?fs=thumb&ID="+e+"&t="+t},_selectNotifyOption:function(t,i){this._isMenuSelect=!0;var n=this;this._userDetails&&(i||this.zecRecipientsList.ztokenfield("removeAllTokens"),this._selectedUserList=[],"all"===t?e(this._userDetails).each(function(e){n._isMenuSelect=!0,n.zecRecipientsList.ztokenfield("addToken",n._userDetails[e])}):e(this._userDetails).each(function(e){n._isMenuSelect=!0,"ownerandcoowner"!==t||n._userDetails[e].permission.toLowerCase()!==n._getString("coowner.label").toLowerCase()&&n._userDetails[e].permission.toLowerCase()!==n._getString("owner.label").toLowerCase()?"owneronly"===t&&n._userDetails[e].permission.toLowerCase()===n._getString("owner.label").toLowerCase()?n.zecRecipientsList.ztokenfield("addToken",n._userDetails[e]):n._userDetails[e].permission.toLowerCase()===t.toLowerCase()?n.zecRecipientsList.ztokenfield("addToken",n._userDetails[e]):n._isMenuSelect=!1:n.zecRecipientsList.ztokenfield("addToken",n._userDetails[e])}),this._resizeTextArea())},_setMorePosition:function(t){if(this.zecRecipientsList.hasClass("ui-znc-collapse"))if("hide"!==t){var i=this.zecRecipients.find(".ztokenfield__token"),n=i.length;if(n)if(i.last().offset().top>i.first().offset().top){for(var s=0,o=this.zecRecipients.find(".ztokenfield__textbox").hide(),a=0;a<n;a++)s<e(i[a]).offset().left&&e(i[a]).offset().left+e(i[a]).outerWidth()+o.outerWidth()<=i.parent().outerWidth()+this.zecRecipients.find(".ztokenfield ").offset().left?(s=e(i[a]).offset().left,e(i[a])):e(i[a]).hide();this.zecRecipientsList.ztokenfield("getElement").find(".ztokenfield__token:visible:last");this._more.show()}else this._more.hide();else this._more.hide();this.mailSubject.focus(),this._resizeTextArea()}else this._more.hide()},_resizeTextArea:function(){this.message.height([this.zecContainer.height()-(this.mailSubject.parent().outerHeight(!0)+this.zecRecipients.outerHeight(!0)+3)])},_resizeContainer:function(){if(this._errorBanner&&this._errorBanner.length&&"none"!=this._errorBanner.css("display")){var e=this.element.outerHeight()-this._errorBanner.outerHeight(!0);this.zecContainer.css("height",e)}else this.zecContainer.css("height","100%"),this._resizeTextArea()},_expandCollapse:function(e){void 0!==e&&(e?this.zecRecipientsList.removeClass("ui-znc-collapse"):this.zecRecipientsList.addClass("ui-znc-collapse")),parseInt(this.zecRecipientsList.css("min-height"))<this.zecRecipientsList.innerHeight()-20?(this._expandCollapseEnable&&this.zecRecipientsList.removeClass("ui-znc-collapse"),this.selectOption.removeClass("ui-znc-collapse")):this._expandCollapseEnable&&this.zecRecipientsList.addClass("ui-znc-collapse"),this._resizeTextArea()},open:function(){this._getSharedUserList(),this.element.zdialog("open"),this.refresh(),this._triggerEvent(this._EVENTS.ONOPEN,this)},_close:function(){NotifyCollaborator.isMinimized=!1,this.zecRecipientsList.ztokenfield("destroy"),this._actionsBtn.zselect("destroy"),this._actionsBtn.remove(),this.element.zdialog("destroy"),e("#znotifycollaborator").remove(),this._errorBanner&&this._errorBanner.remove(),this._triggerEvent(this._EVENTS.ONCLOSE)},close:function(){this._close()},_placeHolder:function(t,i){e(t).on("focus.placeholder",function(){e(i).hide()}).on("focusout.placeholder",function(){0!==e(this).val().length?e(i).hide():e(i).show()})},_showError:function(t,i){var n=this;if(t=""===t||void 0===t?this._getString("unknownerror.label"):t,this._errorBanner=this.element.find(".zalertbanner.zalertbanner--error"),this._errorBanner.length||(ZAlertBanner.show({message:t,target:"#ui-znc-container",closeButton:!0,type:"error",width:"auto",height:"auto",display:"inline",displayBefore:"#ui-znc-container",closePreviousBanner:!0,animation:{effect:"slide",duration:300}}),this._errorBanner=this.element.find(".zalertbanner.zalertbanner--error"),this._resizeContainer()),this._errorBanner.on("zalertbannerhide",function(){n._closeError(i),i=!1}),i){var s=this.element.find(".zalertbanner__text").text();this.element.find(".zalertbanner__text").html(s+"  <a id='retry' class='zalertbanner__link'>"+this._getString("retry.label","fcommon")+"</a>"),e("#retry").off("click").on("click."+this.widgetName,function(e){n._closeError(i),i=!1})}this._resizeContainer()},_closeError:function(e){this._errorBanner&&(this._errorBanner.is(":visible")&&ZAlertBanner.hide("#"+this._errorBanner.attr("id")),this.zecContainer.height(""),this._resizeTextArea(),!0===e&&this._getSharedUserList(!0),this._errorBanner=void 0)},maximize:function(){this.element.zdialog("maximize")},_getString:function(e,t,i){return FCUtil.getI18NString(t||"znotifycollaborator",e,i,this.keys)},_triggerEvent:function(t,i){return e("body").trigger("znotifycollaborator"+t,i)},keys:{"sendmeacopy.label":"Send me a copy","retry.label":"Undo","cancel.label":"Cancel","close.label":"Close","send.label":"Send","sending.label":"Sending...","more.label":"more","title.label":"Notify Collaborator","message.label":"Message","subject.label":"Subject","recipients.label":"To","allcollaborators.label":"All Collaborators","owner.label":"owner","coowner.label":"coowner","owneronly.label":"Owner Only","ownerandcoowner.label":"Owner & Co-Owners","selectedrecipients.label":"Specific People...","sendmailwithoutsubject.label":"Would you like to send mail without a subject?","unknownerror.label":"Sorry! We are unable to get the collaborators of this document due to an unknown error. Please try to notify them after some time.","invaliduser.label":"You have entered an invalid collaborator","noresultsfound.label":"No results found for '#query#'.","emptydatawarning.label":"Are you sure you want to notify without a subject or text in the body?","mail_fail_error.label":"Sorry! We are unable to send the notification due to an unknown error. Please try again or later.","sendmailsuccessfully.label":"Notify mail has been send successfully"}};return{open:function(e,i){NotifyCollaborator.isMinimized?(NotifyCollaborator.isMinimized=!1,t.maximize()):t._create(e)},close:function(){t.close()}}}(window.jQuery);jQuery(function(e){e.extend({_isAjaxUploadCompatible:function(){return void 0==this._isCompatible&&(this._isCompatible=void 0!==(new XMLHttpRequest).upload),this._isCompatible},_isFileParam:function(t){if("object"==typeof t)try{var n=e(t)[0];if(n.name||n.files||n.nodeType&&e(n).is("input[type=file]"))return!0}catch(e){}return!1},_parseFiles:function(t){var n={},a=this;return t=e.isArray(t)?t:[t],this._isAjaxUploadCompatible()?e.each(t,function(t,r){e.each(r,function(t,o){if(a._isFileParam(o)){var i=[];if(e(o).is("input[type=file]")){for(var s=0;s<e(o).length;s++){var u=e(o)[s];u.nodeType&&u.files&&i.push(u.files)}n[t]=i}else n[t]=o;r[t]=void 0,delete r[t]}})}):e.each(t,function(t,r){e.each(r,function(t,o){if(a._isFileParam(o)){var i=e(o)[0];i.nodeType&&e(i).is("input[type=file]")&&i.files&&(o=i.files),n[t]=o,r[t]=void 0,delete r[t]}})}),n},ajaxUpload:function(e,t,n,a,r,o){var i=this._parseFiles(t);return this._getUploader().post(this,e,t,i,n,a,r,o)},ajaxDownload:function(e,t,n,a){return this.uploaders.iframeUploader.get(this,e,t,[],n,a)},_getUploader:function(){return this.uploaders[this._isAjaxUploadCompatible()?"ajaxUploader":"iframeUploader"]},_getParamFilledURL:function(t,n){return e.each(n,function(e,n){t+=-1==t.indexOf("?")?"?":"&",t+=e+"="+unescape(encodeURIComponent(n))}),t},uploaders:{ajaxUploader:{post:function(t,n,a,r,o,i,s,u){var c=this;r=this._getFiles(r);var l=[];return u?e(r).each(function(e,r){var u=c.upload(t,n,a,r,o,i,s);l.push(u)}):l=c.upload(t,n,a,r,o,i,s),this._controller(l,r)},_controller:function(t,n){return{files:n,abort:function(){e.each(t,function(e,t){t.abort()})},getFilesDetails:function(){var t=[];return e(n).each(function(e,n){t.push({name:n.fileName,size:n.size})}),t}}},_getFiles:function(t){var n=this,a=[];return e.each(t,function(t,r){r.name?(r.pname=t,a.push(r)):e.each(r,function(e,r){if(r.name)r.pname=t,a.push(r);else{var o=n._getFiles(r);for(e=0;e<o.length;e++){var i=o[e];i&&(i.pname=t,a.push(i))}}})}),a.length||(a[0]=void 0),a},_getFileName:function(e){return e.fileName?e.fileName:e.name},_getFileSize:function(e){return e.fileSize?e.fileSize:e.size},upload:function(e,t,n,a,r,o,i){var s=new XMLHttpRequest,u=r.customData?r.customData:void 0;if(s.onreadystatechange=function(){if(4==s.readyState){var e=200==s.status?r.success:r.fail;e&&e(s.responseText,s,u)}},r.progress){var c=function(e){var t=Math.floor(e.loaded/e.total*100);e.file=a,void 0!==u?(u.percentage=t,r.progress(e,u)):r.progress(e,t)};s.addEventListener("progress",c,!1),s.upload.addEventListener("progress",c,!1)}return r.complete&&(s.addEventListener("load",r.complete,!1),s.upload.addEventListener("load",r.complete,!1)),r.beforeSend&&r.beforeSend(s),s.open("POST",t,!i),this["undefined"!=typeof FormData?"_doFormUpload":"_doBinaryUpload"](s,n,a,r),s},_doFormUpload:function(t,n,a,r){var o=new FormData;e.each(n,function(e,t){o.append(e,t)}),e.each(a,function(e,t){t&&o.append(t.pname,t)}),r.setHeaders&&r.setHeaders(t),t.send(o)},_doBinaryUpload:function(t,n,a,r){var o="---------------zoho"+Math.random(),i="\r\n--"+o,s="",u=this;e.each(n,function(e,t){s+="\r\n"+u._getMultiPartParamStr(e,t),s+="\r\n--"+o}),i+=s,a?(i+="\r\n",i+=this._getMultiPartFileParamStr(a.pname,a),i+="\r\n--"+o+"--"):i+="--",r.setHeaders&&r.setHeaders(t),t.setRequestHeader("Content-Length",i.length),t.setRequestHeader("Content-Type","multipart/form-data; charset: UTF-8; accept-charset: UTF-8; boundary="+o),t.setRequestHeader("Connection","close"),t.sendAsBinary(i)},_getMultiPartFileParamStr:function(e,t){return'Content-Disposition: form-data; name="'+e+'"; filename="'+unescape(encodeURIComponent(t.fileName))+'"\r\nContent-Type: application/octet-stream\r\n\r\n'+t.getAsBinary()},_getMultiPartParamStr:function(e,t){return'Content-Disposition: form-data; name="'+e+'"\r\n\r\n'+unescape(encodeURIComponent(t))}},iframeUploader:{post:function(e,t,n,a,r,o){return this._perform(e,t,n,a,r,o)},get:function(e,t,n,a,r,o){return this._perform(e,t,n,a,r,o,!0)},_perform:function(t,n,a,r,o,i,s){var u=this._createIframe(),c=this._fillParams(t,n,a,r,u.attr("name"),s),l=o.customData?o.customData:void 0;t=this;return u.load(function(n){var a=t.getResponse(e(u[0].contentWindow.document.body),i);o.success&&o.success(a,void 0,l),c.remove(),u.remove()}),o.beforeSend&&o.beforeSend(),c.submit(),this._controller(u,c,r)},getResponse:function(t,n){switch(n){case"json":case"jsonp":return e.parseJSON(t.text());case"html":return t.html();case"text":default:return t.text()}},_controller:function(t,n,a){return{files:[a],abort:function(){t[0].contentWindow.stop()},getFilesDetails:function(){var t=[];return e(a).each(function(n,a){a=e(a),t.push({name:a.val(),size:""})}),t}}},_createIframe:function(){var t="uploadFrame"+(new Date).getTime(),n=e('<iframe name="'+t+'">').attr({src:"about:blank",height:"0",width:"0",frameborder:"0",id:t});return this._iframe=n,e(document.body).append(n),n},_getParamFilledForm:function(t,n,a){e.each(n,function(n,a){if(a){var r=e("<input type=hidden name="+n+">").attr({value:a});t.append(r)}}),e.each(a,function(n,a){(a=e(a)).data("parent",a.parent()),a.clone(!0).insertBefore(a),t.append(a)})},_fillParams:function(t,n,a,r,o,i){var s=e("<form>").attr({method:i?"get":"post",target:o,action:n});return i||(s.attr("enctype","multipart/form-data"),s[0].encoding="multipart/form-data"),e(document.body).append(s.fadeTo(0,0)),this._getParamFilledForm(s,a,r),s}}}})});var FCImageLibrary=function(e,o){var t="library",i=!1,a={target:void 0,imagestype:"Library",selectTab:!0,options:{noOfImagesToBeSelected:50,multiselect:!0,insertFrom:"uploadFromLocal",onSelect:void 0,onInsert:void 0,onInsertType:void 0,setSearchKey:void 0,callbackUrl:void 0,gadgetsURL:void 0,addToLibrary:void 0,enableGadgets:!0,enableFromLocal:!0,enableFromURL:!0,enableFlickr:!0,enableGooglePhotos:!0,enableWebSearch:!0,isRemoteAPIMode:!1,uploadURL:void 0,gadgets:{hostname:"",serviceName:"writer"}},beforeInit:function(){var o=e("#imagelibrary"),t=o.parent().parent(),i=t.find("#insert"),a=this;if(i.zbutton("disable"),o.zimagehandler({multiselect:this.options.multiselect,onSelect:this.options.onSelect,noOfImagesToBeSelected:this.options.noOfImagesToBeSelected,onInsert:this.options.onInsert,onInsertType:a.options.onInsertType,insertEle:i,deleteEle:e("#delete"),deleteAction:function(e){a._deleteImages()},serverUrl:a.options.gadgetsURL,callbackUrl:r(),ticket:void 0,addToLibrary:!a.options.isRemoteAPIMode,uploadAction:function(e,o,t,i,r){a._uploadImage(e,o,t,i,r)}}),o.on("zimagehandlerselect",function(e,o){i.zbutton("enable")}).on("zimagehandlerunselectall",function(e,o){i.zbutton("disable")}).on("ztabpanelswitch",function(e,o){i.zbutton("disable")}),this.selectTab=!1,!a.options.isRemoteAPIMode){var n=e("<span>").html("<sup>*</sup>"+FCUtil.getString("show.editor.image.licensemsg")).css({display:"block",color:"#CF4236"});t.find(".ui-dialog-footer-status").removeClass("ui-widget-content").css({float:"left","margin-top":"12px","text-align":"left"}).show().append(n)}this._bindEvents()},_deleteImages:function(){e.ZImageAction.deleteImages()},_uploadImage:function(o,t,i,a,r){e.ZImageAction.uploadImage(o,t,i,a,r)},_bindEvents:function(){var o=e("#Library");o.on("dragover",function(e){o.addClass("ui-lib-uploader-dragover")}).on("dragleave",function(e){o.removeClass("ui-lib-uploader-dragover")}).on("drop",function(e){o.removeClass("ui-lib-uploader-dragover")}).on("keydown",function(o){if(o&&o.target&&"imagesearchinput"===e(o.target).attr("id"))return;46!=o.keyCode&&8!=o.keyCode||(e.ZImageAction.deleteImages(),o.stopPropagation(),o.preventDefault())})},init:function(){var t=e("#imagelibrary"),i=this.options.setSearchKey;t.zimagehandler("setSearchKey",i),o.tabpanel(t),o.tabpanel(t).openTab("#"+this.options.insertFrom+"tab"),this.selectTab=!0}};function r(){var e=window.location.origin;void 0!==e&&""!==e||(e=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));var o=FComponents.option("contextPath");return void 0!==o&&"/"!==o.substring(0,1)&&(e+="/"),e+FComponents.option("contextPath")+"checkconf.do"}var n={contextPath:"",listing:{getURL:"",customData:""},delete:{postURL:"",customData:""},add:{uploadURL:"",customData:""}};function l(){return FComponents.getDriveInfo(a.options)}return{downloadURL:void 0,open:function(o){if(!i){o||(o={}),o.myLibrary&&((n=e.extend(!0,n,o.myLibrary)).contextPath=""!==n.contextPath?window.location.protocol+n.contextPath:"");var l=e.extend(!0,a.options,o);l.callbackUrl=r(),l.noOfImagesToBeSelected=void 0!=o.noOfImagesToBeSelected?o.noOfImagesToBeSelected:l.noOfImagesToBeSelected,l.downloadURL=void 0!=o.downloadURL?o.downloadURL:l.downloadURL,l.product_type=void 0!=o.product_type?o.product_type:l.product_type,l.owner_id=void 0!=o.owner_id?o.owner_id:l.owner_id,l.setSearchKeyWord=void 0!=o.defaultSearchKeyword?o.defaultSearchKeyword:l.setSearchKeyWord;var d=n.add&&n.add.uploadURL?n.add.uploadURL:"";(""!==d&&void 0!==d||""!==l.uploadURL&&void 0!==l.uploadURL)&&(l.customUpload=!0),n.customData=l.customData,l.isRemoteAPIMode=void 0!==o.uploadURL||void 0!==o.isRemoteMode&&o.isRemoteMode;var s=fromurlDiv=libraryDiv=flickrDiv=photosDiv=websearchDiv=dropboxDiv="";a.options.activeTab=void 0!==a.options.activeTab?a.options.activeTab:"#fromlocal",a.options.tabPosition=void 0!==a.options.tabPosition?a.options.tabPosition:"left";var c='<div id="imagelibrary" class="library" data=\'{"openOn":"click","tabPosition":"'+a.options.tabPosition+'","activeTab":"'+a.options.activeTab+'"}\'><ul class="menutabs">';l.enableFromLocal&&(c=c+'<li ttype="uploadFromLocal" id="uploadFromLocaltab" data-library-Options=\'{"imageCategory": "local"}\'><a href="#fromlocal">'+this._getString("upload.label")+"</a></li>",s='<div id="fromlocal"></div>'),l.enableFromURL&&(c=c+'<li ttype="uploadFromURL" id="uploadFromURLtab" data-library-Options=\'{"imageCategory": "url"}\'><a href="#fromurl">'+this._getString("fromurl.label")+"</a></li>",fromurlDiv='<div id="fromurl"></div>'),(l.enableFromLocal||l.enableFromURL)&&"top"!==a.options.tabPosition&&"bottom"!==a.options.tabPosition&&(c+='<li ttype="custom"  data-custom="true" class="ui-tabs-separatorline"></li>'),l.isRemoteAPIMode||(c=c+'<li ttype="Library" id="Librarytab" data-library-Options=\'{"imageCategory": "Library", "authURL": true, "controls": true}\'><a href="#Library">'+this._getString("mylibrary.label")+"</a></li>",libraryDiv='<div id="Library" tabindex=0 ></div>'),l.enableGadgets&&(l.enableGooglePhotos&&(c=c+'<li id="picasatab" ttype="Picasa" data-library-Options=\'{"imageCategory": "Picasa", "search": true}\'><a href="#Picasa">'+this._getString("googlephotos.label")+"</a></li>",photosDiv='<div id="Picasa" ></div>'),l.enableFlickr&&(c=c+'<li id="flickrtab" ttype="Flickr" data-library-Options=\'{"imageCategory": "Flickr","search": true}\'><a href="#Flickr">'+this._getString("flickr.label")+"</a></li>",flickrDiv='<div id="Flickr" ></div>'),l.enableDropBox&&(c=c+'<li id="dropboxtab" ttype="Dropbox" data-library-Options=\'{"imageCategory": "Dropbox","search": true}\'><a href="#Dropbox">'+this._getString("dropbox.label")+"</a></li>",dropboxDiv='<div id="Dropbox" ></div>'),l.enableWebSearch&&(c=c+'<li id="websearchtab" ttype="Public" data-library-Options=\'{"imageCategory": "Public","search": true}\'><a href="#Public">'+this._getString("websearch.label")+"</a></li>",websearchDiv='<div id="Public" ></div></div>')),c=c+"</ul><div>"+s+fromurlDiv+libraryDiv+photosDiv+flickrDiv+dropboxDiv+websearchDiv+"</div>",imageDialog=e('<div id="'+t+'"></div>').appendTo(e("body")),imageDialog.append(c),a.options=l,e.ZImageAction.customUpload=l.customUpload,imageDialog.zdialog({className:"zimagelibrary-dialog",position:"center",width:980,height:500,buttons:[{text:FCUtil.getString("close.label"),action:"CLOSE"},{id:"insert",class:"ui-zbutton-primary",appearance:"primary",text:FCUtil.getString("insert.label"),action:FCImageLibrary.insertImage,btype:"loader"}],open:function(){a.beforeInit(),a.init()},title:FCUtil.getI18NString("zimagelibrary","title.label"),resizable:!1,modal:!0,autoOpen:!0}).on("zdialogclose.imagelibrary",function(o,a){var r;r=e("#"+t),e.FCDragDropImage.destroy(),r.length&&(e("#imagelibrary").off(),r.off(),i=!1,r.length&&r.remove())}),i=!0,e.FCDragDropImage.init(l.customUpload,n.customData)}},getCustomData:function(e,o){var t=n.customData,i=n[e|="listing"];if(i&&i.customData){var a=i.customData;if(""!==a&&void 0!==a)return a}if(o){var r=FCImageLibrary.getOption("csrf");r&&(t[r.csrfParamName]=FCUtil.getCSRFCookie(r.csrfCookieName))}return t},_getString:function(e,o,t){return FCUtil.getI18NString(t||"zimagelibrary",e,o||void 0,a.options.keys)},getOption:function(e){return a.options[e]},getLibraryListingURL:function(){var e=FComponents.option("contextPath")+"getlibraryimages.do"+l(),o=n.listing&&n.listing.getURL?n.listing.getURL:"";return""!==o&&void 0!==o&&(e=""!==n.contextPath?n.contextPath+o:o),e},getDeleteURL:function(){var e=FComponents.option("contextPath")+"fcdeleteimage.do"+l(),o=n.delete&&n.delete.postURL?n.delete.postURL:"";return""!==o&&void 0!==o&&(e=""!==n.contextPath?n.contextPath+o:o),e},getUploadURL:function(){var e=a.options.uploadURL;if(!e){e=FComponents.option("contextPath")+"fcuploadimage.do"+l();var o=n.add&&n.add.uploadURL?n.add.uploadURL:"";""!==o&&void 0!==o&&(e=""!==n.contextPath?n.contextPath+o:o)}return e},insertImage:function(){e.ZImageAction.insertImageFromLibrary()},close:function(){var o=e("#"+t);o.length&&o.zdialog("close")}}}(jQuery,ZComponents);!function(e){e.ZImageAction={request:void 0,customUpload:void 0,reqData:void 0,_maxAllowedSize:10485760,insertImageFromLibrary:function(){e("#libraryzdialog").zdialog("disableButton","insert"),e('<div class="ui-imagediglog-overlay">').appendTo("#imagelibheader"),e("#imagelibrary").zimagehandler("insert"),e("#LibraryImages").zimagelist("deSelectAll")},uploadImage:function(t,r,a,i,s){a=e.extend(!0,{},a),void 0===r&&(r="false");var o,l=this;i=i||"document",this.customUpload?o=FCImageLibrary.getCustomData("upload",!0):(o={add_lib:r,sourcetype:i})[FComponents.option("csrfParamName")]=FCUtil.getCSRFToken(),o||(o={}),o.imagefile=t;var n={beforeSend:function(){a.beforeSend&&a.beforeSend()},progress:function(e,t){a.updateProgress&&a.updateProgress(t)},success:function(r){var i,s=r;"object"!=typeof s&&(s=e.parseJSON(r)),"success"!==s.request&&"partial"!==s.request||!a.success?l.customUpload&&a.success&&((i=s.IMAGES||s)instanceof Array?a.success(i,t):a.success([i],t)):(i=s.IMAGES)instanceof Array?a.success(i,t):a.success([i],t)},fail:function(e){a.fail&&a.fail(),l.imageErrorResp(e)}};this.validateFiles(t[0].files,t)&&(a.beforeStart&&a.beforeStart(t),e.ajaxUpload(FCImageLibrary.getUploadURL(),o,n,"text"))},validateFiles:function(t,r){this._supportedFormats=e("#imagelibrary").zimagehandler("getSupportedFormats"),this._currAttachmentSize=0;var a=!0;if("undefined"!=typeof FileReader)for(var i=0;i<t.length;++i){var s=t[i],o=s.size;if(this._currAttachmentSize+=o,a){a=this.isValidFileExtension(s.name);break}}if(!a||this._currAttachmentSize>this._maxAllowedSize){var l=FCUtil.getI18NString("zimagelibrary","invalidsizemessage.label",[this._bytesToSize(this._maxAllowedSize)]);return a||(l=FCUtil.getI18NString("zimagelibrary","validfilemessage.label")+"<br/> <br/>"+FCUtil.getI18NString("zimagelibrary","supportedfileformats.label",[this._supportedFormats])),r&&this._clearFile(r),ZAlertDialog.open({type:"error",title:FCUtil.getI18NString("zimagelibrary","error.label"),primaryMessage:l,isMessageHTMLEncoded:!0,buttons:"ok"}),!1}return!0},_clearFile:function(e){e.wrap("<form>").closest("form").get(0).reset(),e.unwrap()},isValidFileExtension:function(t){var r=this._supportedFormats.split(","),a=t.lastIndexOf("."),i=t.substr(a+1).toLowerCase();return!(e.inArray(i,r)<0)},_bytesToSize:function(e){var t=["bytes","KB","MB","GB","TB"];if(0==e)return e+""+t[0];var r=parseInt(Math.floor(Math.log(e)/Math.log(1024)));return Math.ceil(e/Math.pow(1024,r)*100)/100+" "+t[r]},deleteImages:function(){var t=[],r=e("#imagelibrary").zimagehandler("getSelectedImageCategory"),a=e("#"+r+"Images").zimagelist("getSelectedImages"),i=!1;if(!e.ZImageAction.request&&confirm(FCUtil.getI18NString("zimagelibrary","confirmdeletemessage"))){if(a.length){e.each(a,function(e,r){var a=r.RESOURCE_ID||r.IMAGE_ID;t.push(a)});var s={imageId:t};this.customUpload?s=e.extend(!0,s,FCImageLibrary.getCustomData("delete")):s[FComponents.option("csrfParamName")]=FCUtil.getCSRFToken(),e.ZImageAction.request=e.ajax({type:"post",url:FCImageLibrary.getDeleteURL(),data:s,traditional:!0,success:function(r){e.ZImageAction.request=void 0;"object"!=typeof r&&e.parseJSON(r),e("#imagelibrary").zimagehandler("removeSelectedImages",{imageIds:t}),i=!0},fail:function(t){e.ZImageAction.request=void 0}})}return i}},imageErrorResp:function(t){respText=t.replace(/'/g,'"'),"object"!=typeof respText&&(responseObj=e.parseJSON(respText)),respText&&respText.errorMsg&&alert(respText.errorMsg)}}}(jQuery);!function(e,i){var t={CLASSES:{},_imageLibrary:void 0,_imageLibraryContainer:void 0,_startIndex:0,_imageCategory:void 0,_header:void 0,_urlInfo:void 0,_supportedFormats:"jpg,png,gif,jpeg,bmp",_imagesType:"Google",options:{noOfImagesToBeSelected:10,count:20,multiselect:!0,imagelist:void 0,pagination:!0,selectedCount:1,thumbMaxHeight:160,widgetEventPrefix:"image",keys:{"rights.label":"License",nolicense:"Not filtered by license",licensereuse:"Free to use or share",licensecommercialreuse:"Free to use or share, even commercially",licensereusewithmodification:"Free to use, share or modify",licensecommercialreusewithmodification:"Free to use, share or modify, even commercially"}},_EVENTS:["beforeinsert","insert","delete","select","unselectall"],_create:function(i,t){this.element=i,this.options=e.extend({},this.options,t),this._initEvents()},_initEvents:function(){var i=this;this._createLoader(),this.options.defaultSearchOption&&(this._imagesType=this.options.defaultSearchOption),this.element.on("ztabpanelbeforeswitch",function(t,a){i._nextPageToken=void 0,i._selectedCategory=a.tabData.panelId,i._selectedTab=a.tab,i._selectedOptions=a.tabData,i._imageLibrary=e("#"+i._selectedCategory),e(i._imageLibraryContainer).empty(),i._imageCategory=i._selectedOptions.libraryOptions.imageCategory,i._isInsertFromWeb="Public"===i._imageCategory||"Picasa"===i._imageCategory||"Flickr"===i._imageCategory||"url"===i._imageCategory,i._imageCategory="Public"==i._imageCategory?i._imageCategory+i._imagesType:i._imageCategory;var r="Public"==i._selectedCategory?"PublicGoogle":i._imageCategory;i._imageLibraryContainer=e("#"+r+"ImagesContainer",i._imageLibrary),i._header=e("#imagelibheader",i._imageLibrary),i._imageLibrary.css({float:"left",width:"100%"}),i._imageLibraryContainer.length||(i._imageLibraryContainer=i._createLibraryContainer()),"url"==i._imageCategory&&(i._urlInfo=void 0);var s="local"==i._imageCategory||"url"==i._imageCategory;i._imageLibraryContainer.empty(),i._header.length||s||(i._header=i._createHeader().insertBefore(i._imageLibraryContainer).hide()),i._header.show();var o=i._header.find(".ui-lib-search");if(o.length&&o.find(".ui-lib-search-input").val(FCUtil.getString("search.label",i.options.keys)),e.ZImageLibrary.Public.Flickr.allowCC){var n=e("#imagelibrary").parent().parent();e("#licenseMsg",n).show(),e("#flickrLicenseMsg",n).hide()}i._keyword=void 0,s?(i._loader.hide(),"local"==i._imageCategory?i._showUploadContent():i._showURLUploadContent()):(i._header.hide(),i._loader.show(),i.getImages(1))})},_createLoader:function(){this._loader=e("<div>").addClass("ui-lib-loader ui-lib-loader-pos").hide().appendTo(this.element)},getSelectedImageCategory:function(){return this._imageCategory},setImageCategory:function(e){this._imageCategory=e||"Library"},_createHeader:function(){var i=e("<div>").attr("id","imagelibheader").addClass("ui-lib-header");return this._createSearchEle().appendTo(i),"PublicGoogle"===this._imageCategory&&i.append(this._createRights()),e.ZImageLibrary[this._selectedCategory].authURL&&this._createInfoDiv().appendTo(i),this._selectedOptions.libraryOptions.controls&&(this._controlDiv=this._createControls(),this._controlDiv.appendTo(i)),i},_createInfoDiv:function(){var t=e("<div>").addClass("ui-lib-userinfo"),a=this,r=e.ZImageLibrary[a._imageCategory].authURL;if(r&&"true"!=r.toString()){e("<span>").addClass("ui-lib-username").appendTo(t);var s=e("<img>").addClass("ui-lib-userphoto").appendTo(t),o=e("#"+this._imageCategory+"switchuserMenu");o.length||(o=i.createMenu(this._imageCategory+"switchuserMenu",[{id:"switchuser",label:this._getString("signinasadifferentuser.label")}],{direction:"bottom-right",type:"text_only"})),o.on("zmenuitemclick",function(e,i){a._switchAccount(r)}),s.attr("data-menu-id",this._imageCategory+"switchuserMenu")}return t},_getInternetExplorerVersion:function(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var i=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(i)&&(e=parseInt(RegExp.$1))}return e},_updateAuthorNameAndPhoto:function(i){e("#"+this._imageCategory+"searchtype");if("public"!=this._imagesType[this._imageCategory]){var t=this._header.find(".ui-lib-userinfo .ui-lib-username"),a=this._header.find(".ui-lib-userinfo .ui-lib-userphoto");t.text(i.name),a.attr("src",i.photo)}this._header.show()},_createSearchEle:function(){var i=e("<div>").addClass("ui-insimage-search");if("Picasa"!==this._imageCategory){var t=e("<input>").addClass("ui-insimage-search-input ui-corner-left").attr("placeholder",FCUtil.getString("search.label",this.options.keys)).attr("id","imagesearchinput"),a=e("<span>").addClass("ui-insimage-search-icon ui-fcomponents-icon ui-icon-search");t.addClass("ui-icon-public-search-input").removeClass("ui-corner-left")}var r="Public"==this._selectedCategory?"searchtypebtnPublicGoogle":"searchtypebtn"+this._imageCategory,s=e("<div>").addClass("ui-insimage-from").attr({id:r}),o="ui-social-color-icon ui-color-icon-zgoogle";if("PublicGoogle"!=this._imageCategory&&("Library"===this._imageCategory?(o="ui-fcomponents-icon ui-icon-z"+this._imageCategory.toLowerCase(),s.attr("data-text",this._getString("mylibrary.label"))):o="ui-social-color-icon ui-color-icon-z"+this._imageCategory.toLowerCase(),s.css({cursor:"default","text-align":"left"})),"Public"===this._selectedCategory){var n=this._imagesType?this._imagesType.toLowerCase():"google";s.zmenubutton({iconClass:"ui-social-color-icon ui-color-icon-z"+n,menuId:"publicSearchTypeMenu"})}else s.zbutton({icon:o});return s.appendTo(i),"Picasa"!==this._imageCategory&&(t.appendTo(i),a.appendTo(i)),"Public"==this._selectedCategory&&(t.addClass("ui-icon-public-search-input").removeClass("ui-corner-left"),this._createSearchTypeMenu()),this._bindSearchEvents(i),i},_bindSearchEvents:function(t){var a=t.find("input"),r=this;a.val();a.on("keydown",function(e){if(e.keyCode==i.keyCode.ENTER){var t=a.val();r._keyword=t,r._isSearchEntered=!0,t&&(r._curentImagesList=r.getImagesList(),r._imageLibraryContainer.empty(),r.getImages(1,void 0,!0))}}).on("focus",function(i){e("#"+r._imageCategory+"Images").zimagelist("deSelectAll"),r._keyword||a.val("")}),a.on("keyup",function(e){var i=a.val();!i&&r._isSearchEntered&&(r._keyword=i,r._isSearchEntered=!1,-1!=r._imageCategory.indexOf("Public")||(r._imageLibraryContainer.empty(),r._buildImages(r._curentImagesList,void 0,!1)))}),t.find("span.ui-insimage-search-icon").on("click",function(e){r._keyword=a.val(),r._isSearchEntered=!0,r._imageLibraryContainer.empty(),r.getImages(1,void 0,!0)})},_createSearchTypeMenu:function(t){var a=this,r=["Google","Flickr"];this.options.publicImagesTypes&&(r=this.options.publicImagesTypes);var s=[];e.each(r,function(e,i){var t={id:i.toLowerCase()+"_public",itemType:"radio",name:"searchType",customAttributes:{"data-op":i},custom:!0,innerHTML:'<div class="zmenu__iconcontainer"><i class="zmenu__icon"></i></div><span style="display:block" class="ui-social-color-icon ui-color-icon-z'+i.toLowerCase()+'"></span>'};a._imagesType===i&&(t.checked=!0),s.push(t)});a=this;return this._searchMenu=e("#publicSearchTypeMenu"),this._searchMenu.length&&this._searchMenu.remove(),this._searchMenu=i.createMenu("publicSearchTypeMenu",{},{contentType:"icon-text"}),this._searchMenu.zmenu("addMenuItems",s),this._searchMenu.on("zmenuitemclick",function(i,r){a._imageLibraryContainer.empty();r.menuitem.find(".ui-zmenu-text").text();var s=e("#searchtypebtnPublicGoogle");a._imagesType=e(r.menuitem).data("op");var o="z"+a._imagesType.toLowerCase();if(s.zmenubutton("setAttribute","iconClassName","ui-social-color-icon ui-color-icon-"+o),s.parent().find(".ui-lib-search-input"),a._imageCategory=a._selectedCategory+a._imagesType,"PublicGoogle"!==a._imageCategory||e("#licenseDiv").length?"PublicGoogle"===a._imageCategory&&e("#licenseDiv").length?e("#licenseDiv").show():e("#licenseDiv").length&&e("#licenseDiv").hide():t.append(a._createRights()),e.ZImageLibrary.Public.Flickr.allowCC){var n=e("#imagelibrary").parent();e("#licenseMsg",n).show(),e("#flickrLicenseMsg",n).hide()}a.getImages(1)}),this._searchMenu},_createLibraryContainer:function(){return e("<div>").attr("id",this._imageCategory+"ImagesContainer").addClass("ui-lib-image").appendTo(this._imageLibrary)},getImages:function(i,t,a){this._startIndex=i;var r=this,s=r.options.sortOrder;if(r._selectedOptions.libraryOptions.imagelist){var o=r._selectedOptions.libraryOptions.imagelist;this._buildImages(o,i,a)}else{var n=-1!=r._imageCategory.indexOf("Public"),l=n?e.ZImageLibrary[r._selectedOptions.libraryOptions.imageCategory][r._imagesType]:e.ZImageLibrary[r._imageCategory];n?(r._selectedOptions.libraryOptions.imageCategory,r._imagesType):r._imageCategory;r._loader.show(),n&&!r._keyword&&(r._keyword=this.options.publicSearchKeyword,r._imageLibrary.find(".ui-icon-public-search-input").val(r._keyword));var g=t||r.options.count;if(e.ZImageLibrary.Public.Flickr.allowCC&&"PublicFlickr"===r._imageCategory){var d=e.ZImageLibrary.Public.Flickr.licenseTypes,c=e.ZImageLibrary.Public.Flickr.licenseIndex;c=void 0===c||c>=d.length-1?0:c+1,e.ZImageLibrary.Public.Flickr.licenseIndex=c;var h=d[c],u=e.ZImageLibrary.Public.Flickr.licenseURL;e.ZImageLibrary.Public.Flickr.URL=u.replace("{0}",h),g=r.options.flickrImageLimit?r.options.flickrImageLimit:g}var p=r._imageCategory;"Picasa"===r._imageCategory&&(i=this._nextPageToken),l.load(r,i,g,r._keyword,s,function(e,t){r._loader.hide();var s="string"==typeof t?JSON.parse(t):t;s||(s={IMAGES:[],TOTALCOUNT:0}),"local"!=r._imageCategory&&p==r._imageCategory&&r._buildImages(s,i,a)})}},_switchAccount:function(e){this._createIframeAndLoadContent(e,!0)},_createIframeAndLoadContent:function(i,t){var a=this,r=this._selectedOptions.libraryOptions;this._imageLibraryContainer.empty(),this._loader.hide(),this._header.hide();var s=e.ZImageLibrary.updateServiceName({}).zservice,o=this.options.serverUrl+"/";if("Picasa"===this._imageCategory){this._loader.show();var n={action:t?"revoke":"add",zservice:s,library:"picasa"},l={success:function(i){if(a._loader.hide(),i.isAuthenticated)a._picasaIsAuthenticated=!0;else{var t=[],r=e.ZImageLibrary[a._imageCategory];t.push(r.privacyLink),t.push(r.termsLink),t.push(FComponents.option("suite"));var n=a._getString("authenticatemessage",t);a._imageLibraryContainer.append('<div class="zimagelibrary__authentication" id="zimagelibrary__authentication"><i class="zimagelibrary__icon--flickr"></i><div class="zimagelibrary__authcontent"><p id="zimagelibrary__disclaimer">'+n+'</p><button id="zimagelibrary_authbutton" type="button">'+a._getString("authenticateYahoo")+"</button></div></div>"),e("#zimagelibrary_authbutton").on("click",function(){a._openWindow(o+"auth/google?zservice="+s+"&authScopes=GPHOTOS.ALL&multipleAccounts=false&serURL="+a.options.callbackUrl)}),e(window).off("message.zimagelibrary").on("message.zimagelibrary",function(i){e("#zimagelibrary__authentication").remove(),e(window).off("message.zimagelibrary");var t=i.originalEvent.data;"ZohoComponents"===t.from&&"ImageLibrary"===t.for&&a.getImages(1)})}},fail:function(e){a._loader.hide()}};FCUtil.ajaxUtil("checktpauthentication.do","POST",n,l)}else{o+=i+"serURL="+this.options.callbackUrl+"&border=no","Flickr"===this._imageCategory&&(o+="&zservice="+s);var g=e("<iframe>").attr({id:r.imageCategory+"authContent",src:o});g.appendTo(this._imageLibraryContainer),g.load(function(){var i=g[0].contentWindow;try{i.loadImages=function(){a.getImages(1)},e(i.document).trigger("ready")}catch(e){}})}},_openWindow:function(e){var i=parseInt(69*screen.width/100),t=parseInt(63*screen.height/100),a=screen.width?(screen.width-i)/2:0,r="height="+t+",width="+i+",top="+(screen.height?(screen.height-t)/2:0)+",left="+a;r+=",scrollbars=false",r+=",resizable=false",__win=window.open(e,"ZAuthenticateZoho",r)},_buildImages:function(e,i,t){var a=void 0;if((e=e||{}).IMAGES||"Library"===this._imageCategory){if(this._TOTALCOUNT=e._TOTALCOUNT,"public"!=this._imagesType[this._imageCategory]||!options.PUBLIC_URL){var r={};e.IMAGES[0]&&(a=e.IMAGES[0].AUTHOR_NAME),r.name=a||e.USER_NAME,r.photo=e.USER_PHOTO,this._updateAuthorNameAndPhoto(r)}this._header.show(),this._buildContainer(e,i,t)}else this._createContainer(e,i,t)},_createContainer:function(i,t,a){"Picasa"===this._imageCategory||"Flickr"===this._imageCategory?this._createIframeAndLoadContent(e.ZImageLibrary[this._imageCategory].authURL):this._buildContainer(i,t,a)},_showUploadContent:function(){var i=this;this._imageLibraryContainer.empty(),i._loader.hide();var t=e("<div>").addClass("ui-lib-uploader-div"),a=this._getString("chooseanimagetoupload.label"),r=e("<input/>").attr({type:"file",label:a,name:"imagefile",id:"imagefile",multiple:this.options.multiselect,accept:"image/jpg,image/png,image/jpeg,image/gif,image/bmp"}),s=e("<h3>").text(this._getString("dragdropimages.label")),o=e("<h5>").text(this._getString("or.label")),n=e("<div>").addClass("ui-lib-uploader-content").append(s).append(o).append(r).appendTo(t);i._uploadContent=n;var l=this._getInternetExplorerVersion();if((-1===l||-1!==l&&l>9)&&r.zfileupload({text:a}),r.on("change",function(e){var t=i._imageLibraryContainer.find("#imagefile"),a=i.options.addToLibrary&&i._addToLib[0].checked?"true":"false",s={beforeSend:function(e){r.zfileupload("setAttribute","disabled",!0),r.closest("label").addClass("ui-state-disabled"),i.showProgressBar()},success:function(e){i.hideProgressBar(),i.uploadProgressbar.zprogressbar("setValue",0);var t="string"==typeof e?JSON.parse(e):e;r.val(""),r.zfileupload("setAttribute","disabled",!1),r.closest("label").removeClass("ui-state-disabled"),"local"==i._imageCategory?i.insert(t,a):i.getImages(1)},updateProgress:function(e){i.updateUploadProgressbar(e)},fail:function(e){r.val(""),r.zfileupload("setAttribute","disabled",!1),r.closest("label").removeClass("ui-state-disabled")}};i._uploadFiles(t,a,s,void 0,"false",!0)}),this.options.addToLibrary){var g=e("<div>").addClass("ui-lib-addToLib-container"),d=e("<input>").attr("type","checkbox").addClass("ui-lib-addToLib-check");d[0].checked=!0;var c=e("<label>").appendTo(g);e("<span>").appendTo(c).text(this._getString("addtolibrary.label")),d.appendTo(c),g.appendTo(n),i._addToLib=d,g.hide()}t.appendTo(this._imageLibraryContainer),this.uploadProgressbar||(this.uploadProgressbar=e("<div>").attr({class:"ui-lib-upload-progressbar",id:"ui-lib-upload-progressbar"}).appendTo(t),this.uploadProgressbar.zprogressbar({statusMessage:{text:"#value#%",displayType:"inline",position:"center"}}))},_handleBeforeInsert:function(e){var i=this,t=new FileReader;t.readAsDataURL(e),t.onload=function(e){var t=new Image;t.src=e.target.result,t.onload=function(){i._beforeInsert([{IMAGE_HEIGHT:t.height,IMAGE_NAME:t.name,IMAGE_URL:t.src,IMAGE_WIDTH:t.width}])}}},_uploadFiles:function(e,i,t,a,r,s){if(e&&e.get(0)&&e.get(0).files&&parseInt(e.get(0).files.length)<=this.options.noOfImagesToBeSelected){var o=this;t.beforeStart=function(e){var i=e[0],t=i.files.length;if(FileReader&&"fromlocal"===o._selectedCategory)for(var a=0;a<t;a++)o._handleBeforeInsert(i.files[a])},this.options.uploadAction(e,i,t,a,r),s&&e.parent().removeAttr("title")}else{var n=this._getString("maximumfilecountreached.label",[this.options.noOfImagesToBeSelected]);this._showError(n)}},showError:function(e){var i=void 0;try{var t="object"!=typeof e?JSON.parse(e):e;"FILE_SIZE_MORE_THAN_ALLOWED_SIZE"===t.message?i=this._getString("invalidsizemessage.label",[this._bytesToSize(this._maxAllowedSize)]):"INVALID_FILE_EXTENSION"===t.message?i=this._getString("validfilemessage.label")+"<br/> <br/>"+this._getString("supportedfileformats.label",[this._supportedFormats]):"Virus-Detected"===t.message?i=this._getString("virusdetectedmessage.label"):"Un-Authorised-Access"===responseObj.message?i=this._getString("unauthorisedaccess.label"):"Unable-To-Import"===responseObj.message&&(i=this._getString("unabletoimport.label"))}catch(e){i=this._getString("internalserver.label")}this._showError(i)},_showError:function(i){"local"==this._imageCategory&&this.hideProgressBar(),void 0===i&&(i=this._getString("internalserver.label")),e("#zimagelist-error").remove(),e("<div>").attr({class:"zimagelist-error",id:"zimagelist-error"}).appendTo("#"+this._imageCategory+"ImagesContainer"),FCUtil.showError(i,e("#zimagelist-error"),"#zimagelist-error",{autoCloseDelay:5e3},"prependTo")},hideProgressBar:function(){"local"==this._imageCategory&&(this._uploadContent.show(),this.uploadProgressbar.hide())},showProgressBar:function(){"local"==this._imageCategory&&(this._uploadContent.hide(),this.uploadProgressbar.show())},updateUploadProgressbar:function(e){this.uploadProgressbar.zprogressbar("setValue",e)},_showURLUploadContent:function(){var i=this;this._imageLibraryContainer.empty();var t=e("<div>").addClass("ui-lib-uploader-div"),a=e("<div>").addClass("ui-lib-urlupload-label");a.text(this._getString("pasteanimageurl.label")),a.appendTo(t);var r=e("<input>").addClass("ui-lib-urlupload-input");r.appendTo(t),r.on("keyup",function(e){i._triggerEvent("unselectall"),i._checkAndPreviewURLImage(e,!1)}).on("paste",function(e){i._triggerEvent("unselectall"),i._checkAndPreviewURLImage(e,!0)});var s=e("<div>").addClass("ui-lib-urlupload-previewContainer");s.appendTo(t).hide();e("<span>").appendTo(s);var o=e("<img>").attr("src","").addClass("ui-lib-urlupload-preview");o.appendTo(s).css({position:"relative"});var n=e("<div>").addClass("ui-lib-urlupload-preview-msg").text(this._getString("previewmessage.label"));n.appendTo(t);var l=e("<div>").addClass("ui-lib-urlupload-preview-error-msg").text(this._getString("imagenotfound.label"));e("<ul>").append(e("<li>").text(this._getString("checkurladdress.label"))).append(e("<li>").text(this._getString("unauthorizedaccess.label"))).appendTo(l),l.hide().appendTo(t),t.appendTo(this._imageLibraryContainer),i._previewArea=s,i._previewImage=o,i._previewMsg=n,i._errorMsg=l,i._urlInput=r,r.focus()},getImageURL:function(){if("url"==this._imageCategory){var e=this._urlInput.val();if(e){var i="Image",t=e.split(":")[0];return"http"!=t&&"https"!=t||(i=e.match(/.*\/([^/]+)\.([^?]+)/i)[1]),[{IMAGE_NAME:i,IMAGE_URL:e}]}}return[]},_checkAndPreviewURLImage:function(i,t){var a=this,r=e(i.target).val();if(t&&i.originalEvent&&i.originalEvent.clipboardData&&i.originalEvent.clipboardData.getData&&(r=i.originalEvent.clipboardData.getData("Text")),void 0!==r&&r.trim().length){this._loader.show(),this._previewMsg.hide();a=this;this._checkImage(r,function(e,i,t){if(a._loader.hide(),e=e.trim(),"success"==i){a._previewMsg.hide(),a._errorMsg.hide();var r=a.findImageDim(t.width,t.height,{width:a._previewArea.width(),height:a._previewArea.height()});a._previewImage.attr("src",e).css({width:r.width,height:r.height}).show(),a._previewArea.show(),a._urlInfo={IMAGE_HEIGHT:t.height,IMAGE_NAME:"",IMAGE_URL:e,IMAGE_WIDTH:t.width,THUMBNAIL_IMAGE_URL:""},a._triggerEvent("select")}else a._previewArea.hide(),a._previewMsg.hide(),a._errorMsg.show(),a._triggerEvent("unselectall")})}else a._errorMsg.hide(),a._previewMsg.show(),a._previewArea.hide(),a._triggerEvent("unselectall")},_checkImage:function(e,i,t){t=t||2e3;clearTimeout(void 0);var a=new Image;a.onerror=a.onabort=function(){clearTimeout(void 0),i(e,"error")},a.onload=function(){clearTimeout(void 0),i(e,"success",{width:this.width,height:this.height})},a.src=e,this._previewMsg.hide(),this._previewArea.hide(),this._errorMsg.hide(),this._loader.show()},updateImageProgress:function(i,t,a){0!==t&&(text=t+" %"),i.text(text);var r=e("#addImageDiv"),s=r.height()/2-i.height()/2,o=r.width()/2-i.width()/2;i.css({top:s+"px",left:o+"px"});var n=t/100*e("#addImageDiv").width();a.width(n)},findImageDim:function(e,i,t){var a,r,s,o=t.width,n=t.height;e>o&&i>n?e>i?r=(a=o)/e*i:a=(r=n)/i*e:e>o?r=(a=o)/e*i:i>n?a=(r=n)/i*e:(r=i,a=e),r>n&&(a-=a/(s=r/(r-n)),r-=r/s),a>o&&(a-=a/(s=a/(a-o)),r-=r/s);var l=o/2-a/2,g=n/2-r/2;return this.placeHolderData&&this.placeHolderData.left&&(l+=this.placeHolderData.left,g+=this.placeHolderData.top),{width:a,height:r,left:l,top:g}},_createControls:function(){var i=this,t=e("<div>").attr("id","ui-zil-header-right"),a=(e("<button>").data({type:"icon_only",text:!1}).attr({id:"deleteEle",title:this._getString("delete.label"),class:"ui-delete-button"}).css({visibility:"hidden"}).appendTo(t).zbutton({icon:" ui-fcomponents-icon ui-icon-ztrash"}).on("click",function(e){i.options.deleteAction()}),e("<div>").attr("id","ui-zil-header-right-inner"));a.appendTo(t);var r=e("<select></select>").attr("id","sorttype");r.appendTo(a),e('<span class="ui-zil-license"></span>').text(this._getString("sortBy.label")).insertBefore(r),this._createSortTypeMenu(r),this.uploadLabel=this._getString("upload.label");var s=e("<input/>").attr({type:"file",name:"imagefile",id:"imagefile",label:this.uploadLabel,multiple:"true",accept:"image/jpg,image/png,image/jpeg,image/gif,image/bmp"}).appendTo(t).hide(),o=e("<span>").css({position:"absolute",top:"80px",left:"60px"}).hide(),n=e("<span>").css({height:"3px",background:"#4ea501",width:"0px",top:"108px",position:"absolute",left:"0px"});return s.on("change",function(t){if(s.val()){e("#addImagesBtn").hide();i._getString("uploading.label");var a=e("#addImageDiv");o.appendTo(a),n.appendTo(a),o.show(),n.show();var r={success:function(t){if(i.updateImageProgress(o,100,n),e.isArray(t)&&t.length)for(var a=0;a<t.length;a++)i.addImage(t[a]);else i.addImage(t);e("#addImagesBtn").show(),o.hide(),n.hide()},fail:function(t){e("#addImagesBtn").show(),o.hide(),n.hide(),i._showError(t)},updateProgress:function(e){i.updateImageProgress(o,e,n)}};i._uploadFiles(s,"true",r,void 0,"false",!1)}}),t},_createRights:function(){var i=this;this._licenseType="notFilteredByLicense";var t=e('<div id="licenseDiv">').addClass("ui-zil-header-right"),a=e("<div>").addClass("ui-zil-header-right-inner");a.appendTo(t);var r=e("<select></select>").attr("id","licensetype");r.appendTo(a),e('<span class="ui-zil-license"></span>').text(this._getString("rights.label")+":").insertBefore(r);var s={nolicense:"notFilteredByLicense",licensereuse:"(cc_publicdomain|cc_attribute|cc_sharealike|cc_noncommercial|cc_nonderived)",licensecommercialreuse:"(cc_publicdomain|cc_attribute|cc_sharealike|cc_nonderived).-(cc_noncommercial)",licensereusewithmodification:"(cc_publicdomain|cc_attribute|cc_sharealike|cc_noncommercial).-(cc_nonderived)",licensecommercialreusewithmodification:"(cc_publicdomain|cc_attribute|cc_sharealike).-(cc_noncommercial|cc_nonderived)"};return e.each(s,function(t,a){var o=i._getString(t);r.append(e("<option></option>").val(s[t]).text(o))}),r.zselect({retainFocus:!1,dropDownMenuHeight:300,width:"223px",type:"text_only",selectedIndex:0}),r.on("zselectchange",function(e,t){i._licenseType=t.value,i._imageLibraryContainer.empty(),i.getImages(1)}),t},_createSortTypeMenu:function(i){var t=this,a=["nameasc","namedesc","oldest","newest"];e.each(a,function(r,s){var o=t._getString(s);i.append(e("<option></option>").val(a[r]).text(o))}),i.zselect({dropDownMenuHeight:300,contentType:"text",selectedIndex:3});var r={nameasc:{orderby:"docorder",order:"ascending"},namedesc:{orderby:"docorder",order:"descending"},oldest:{orderby:"dateorder",order:"ascending"},newest:{orderby:"dateorder",order:"descending"}};i.on("zselectchange",function(e,i){t.options.sortOrder=r[i.value],t.sortImages()})},sortImages:function(){this._imageLibraryContainer.empty(),e("#imagesearchinput","#Library").val(""),this._keyword="",this.getImages(1)},_createDummyImageContainer:function(){var i=e("<div>").addClass("ui-lib-image-loader-container");e("<span>").addClass("ui-lib-loader ui-lib-image-loader").appendTo(i);var t=e("#"+this._imageCategory+"Images").find("ul");return i.insertBefore(t.find("li:first")),i},addImage:function(i){e("#"+this._imageCategory+"Images").length?(e("#"+this._imageCategory+"Images").zimagelist("addImage",i),this._header.show()):(this._buildContainer({IMAGES:[i]},1),this.getImages(1))},removeSelectedImages:function(i){var t=e("#"+this._imageCategory+"Images"),a=t.find("ul").children().length;t.zimagelist("removeSelectedImages",i);var r=i?i.imageIds.length:0,s=a-r;this._selectedOptions.libraryOptions.controls&&this._controlDiv.find("#deleteEle").css({visibility:"hidden"}),this.getImages(s,r);var o=t.zimagelist("getImagesInfo");e.isEmptyObject(o)&&(this._header.hide(),this._showUploadContent())},_constructImageInfo:function(e,i){for(var t=[],a=i;a<i+10;a++){var r=e.IMAGES[a-1];r&&t.push(r)}return t},_buildContainer:function(i,t,a){1===t&&this._selectedOptions.libraryOptions.controls&&this._controlDiv.find("#deleteEle").css({visibility:"hidden"}),this._nextPageToken=i.nextPageToken;var r=e("#"+this._imageCategory+"Images");r.length?this._keyword&&a?(this._imageLibraryContainer.empty(),this._initImageList(r,i)):r.zimagelist("updateImagelist",i):(this._imageLibraryContainer.empty(),r=e("<div>").attr("id",this._imageCategory+"Images").appendTo(this._imageLibraryContainer).addClass("ui-lib-imagecontainer"),this._initImageList(r,i));var s=parseInt(i.TOTALCOUNT);(s=!s&&this.options.imagelist?i.IMAGES.length:s)||"Library"!=this._imageCategory||(this._header.hide(),this._showUploadContent())},_initImageList:function(e,i){var t=this,a=t._selectedOptions.libraryOptions.controls,r=i.TOTALCOUNT>200&&-1!=this._imageCategory.indexOf("Public")?200:i.TOTALCOUNT;e.zimagelist({noOfImagesToBeSelected:this.options.noOfImagesToBeSelected,imagelist:i,imageCategory:this._imageCategory,multiselect:this.options.multiselect,count:this.options.count,thumbnailMaxHeight:this.options.thumbMaxHeight,deleteAction:"Library"==this._imageCategory?this.options.deleteAction:void 0}).on("zimagelistimageinsert",function(e,i){t.insert()}).on("zimagelistselect",function(i,r){e.zimagelist("getSelectedImages").length>t.options.selectedCount?(a&&t._controlDiv.find("#deleteEle").css({visibility:"visible"}),e.zimagelist("removeAllCloseButtons")):a&&t._controlDiv.find("#deleteEle").css({visibility:"hidden"});var s=e.zimagelist("getSelectedImages");t._triggerEvent("select",s)}).on("zimagelistunselectall",function(i,r){a&&t._controlDiv.find("#deleteEle").css({visibility:"hidden"});var s=e.zimagelist("getSelectedImages");t._triggerEvent("unselectall",s)}),t._selectedOptions.libraryOptions.imagelist||e.on("scroll",function(i){if(e[0].scrollHeight-Math.ceil(e.scrollTop())<=e.height()){var a=e.find("ul").children().length+1;"Library"===t._imageCategory&&(a-=1),(a<=r||t._nextPageToken)&&t.getImages(a)}})},_initPagination:function(i,t){i=i>200?200:i;var a=this.element.find(".ui-lib-pagination");!a.length&&i?((a=e("<div>").addClass("ui-lib-pagination").insertAfter(this._imageLibrary)).append(e("<span>").addClass("ui-lib-pagestring").text(this._getString("pageno.label"))),paginationDiv=e("<div>").attr("id",this._imageCategory+"pagination").appendTo(a),paginationDiv.zpagination({totalItems:i,itemsPerPage:this.options.count})):a.find(".ui-pagination").zpagination("updateTotalItems",i,t),this._pagination=a},_triggerEvent:function(e,i){var t={info:i};return this._dispatchEvent(e,e,t)},isAddToLib:function(){return this.options.addToLibrary&&this._addToLib[0].checked?"true":"false"},_beforeInsert:function(i){var t={images:i,insertFrom:this._imageCategory,addedtolib:this.isAddToLib(),onInsertType:void 0!=this.options.onInsertType?this.options.onInsertType:void 0};this.options.onBeforeInsert&&this.options.onBeforeInsert(t),e("#imagelibrary").trigger("imagebeforeinsert",t)},insert:function(i,t){i&&i.IMAGES&&(i=i.IMAGES);var a=i||e("#"+this._imageCategory+"Images").zimagelist("getSelectedImages");"url"==this._imageCategory&&(a=[]).push(this._urlInfo),"fromlocal"!==this._selectedCategory&&this._beforeInsert(a);var r={info:a,insertFrom:this._imageCategory,isInsertFromWeb:this._isInsertFromWeb,addedtolib:t,onInsertType:void 0!=this.options.onInsertType?this.options.onInsertType:void 0};this.options.onInsert&&this.options.onInsert(r),e("#imagelibrary").trigger("imageinsert",r)},deleteImage:function(){var i=e("#"+this._imageCategory+"Images").zimagelist("getSelectedImages"),t=!1;this.options.deleteAction&&(t=this.options.deleteAction(i)),t&&(e("#"+this._imageCategory+"Images").zimagelist("removeSelectedImages"),this._triggerEvent("delete",i))},getImagesList:function(){var i=e("#"+this._imageCategory+"Images").zimagelist("getImagesList");return i.TOTALCOUNT=this._TOTALCOUNT,i},getCurrentImageList:function(){return this._curentImagesList},getSupportedFormats:function(){return this._supportedFormats},setSearchKey:function(e){this.options.publicSearchKeyword=e},doAction:function(i){return e("#"+this._imageCategory+"Images").zimagelist(i)},_getString:function(e,i,t){return FCUtil.getI18NString(t||"zimagelibrary",e,i||void 0,this.options.keys)}};i.registerComponent("ZImageHandler",i.CoreComponent,{}),i.registerComponent("ZImageHandler",i.ZImageHandler,t)}(ZComponents.DOMUtil,ZComponents);!function(e){e.ZImageLibrary={request:void 0,contextPath:"",setContextPath:function(e){this.contextPath=e||""},Library:{URL:"getlibraryimages.do",authURL:"true",search:!0,load:function(t,a,r,o,i,n){var s={};o&&(s.search=o),i&&i.orderby&&(s.orderby=i.orderby,"ascending"===i.order&&(s.asc=!0)),FCImageLibrary.getOption("myLibrary")?(s.orderby=s.orderby?s.orderby:"dateorder",(s=e.extend({},s,FCImageLibrary.getCustomData())).ascending=s.asc,delete s.asc):(s.pn="Library",s.DATE=(new Date).getTime(),s[FComponents.option("csrfParamName")]=FCUtil.getCSRFToken()),s.sIndex=a,s.maxresult=r,e.ZImageLibrary.getImages(t,FCImageLibrary.getLibraryListingURL(),s,n)}},Picasa:{privacyLink:"//policies.google.com/privacy",termsLink:"//policies.google.com/terms",URL:"gettplibraryimages.do",authURL:"auth/google?",search:!0,load:function(t,a,r,o,i,n){var s={sIndex:a||1,maxresult:r};s[FComponents.option("csrfParamName")]=FCUtil.getCSRFToken(),o&&(s.search=o),s=e.ZImageLibrary.updateServiceName(s),e.ZImageLibrary.getImages(t,FComponents.option("contextPath")+this.URL,s,n)}},Flickr:{URL:"zphotos.do?mode=flickr&category=getOwnPhotos",authURL:"flickr?",search:!0,load:function(t,a,r,o,i,n){var s={pn:"Flickr",startindex:Math.ceil(a/r),maxresult:r};o&&(s.search=o),s=e.ZImageLibrary.updateServiceName(s),e.ZImageLibrary.getImages(t,FComponents.option("contextPath")+this.URL,s,n)}},Public:{Flickr:{allowCC:!1,licenseTypes:[4,5,6],licenseURL:"zphotos.do?mode=flickr&category=getLicensePhotos&license={0}",URL:"zpublicphotos.do?mode=flickr&category=getNonUserPublicPhotos",load:function(t,a,r,o,i,n){var s={pn:"PublicFlickr",startindex:a,maxresult:r,search:"Flowers"};o&&(s.search=o),s=e.ZImageLibrary.updateServiceName(s),e.ZImageLibrary.getImages(t,FComponents.option("contextPath")+this.URL,s,n)}},Google:{URL:"zpublicphotos.do?mode=google&category=getPhotos",load:function(t,a,r,o,i,n){var s={pn:"PublicGoogle",startindex:a,maxresult:r<10?r:10,rights:encodeURI("notFilteredByLicense"),search:"Flowers"};o&&(s.search=o),t._licenseType&&(s.rights=encodeURI(t._licenseType)),e.ZImageLibrary.getImages(t,FComponents.option("contextPath")+this.URL,s,n)}}},getImages:function(t,a,r,o){e.ZImageLibrary.request&&e.ZImageLibrary.request.abort(),e.ZImageLibrary.request=e.ajax({type:"GET",url:a,data:r,success:function(e){(e||""!=e)&&(e="string"==typeof e?JSON.parse(e):e,FCImageLibrary.downloadURL=e.downloadURL,o(t,e))}})},updateContextPath:function(t){e.ZImageLibrary.contextPath&&t.IMAGES&&e.each(t.IMAGES,function(t,a){a.THUMBNAIL_IMAGE_URL&&(a.THUMBNAIL_IMAGE_URL=e.ZImageLibrary.contextPath+a.THUMBNAIL_IMAGE_URL)})},updateServiceName:function(e){var t=FCImageLibrary.getOption("gadgets"),a=t&&t.serviceName;return void 0!==a&&""!==a&&(e.zservice=a),e}}}(jQuery);!function(e,t){var a={_imagesInfo:{},_imageLibrary:void 0,_imageLibraryContainer:void 0,_startIndex:0,_EVENTS:["imageinsert","select","unselect","selectall","unselectall"],options:{eventPrefix:"zimagelist",noOfImagesToBeSelected:void 0,count:10,multiselect:!0,imagelist:void 0,keys:{"noimagesavailable.label":"No Images Available"},deleteAction:void 0,thumbnailMaxHeight:160},_create:function(){this.options=t.extend({},e.ZImageList.defaults,this._opts);var i=this,a=-1!=navigator.userAgent.toLowerCase().indexOf("mac");t(document).on("keydown",function(e){(a?e.metaKey||e.shiftKey:e.ctrlKey||e.shiftKey)&&(i._ctrlKey=!0)}).on("keyup",function(e){i._ctrlKey=!1}),this.element.on("click",function(e){t(e.target).hasClass("ui-lib-img")||t(e.target).closest(".zimagelist__options").length||i.deSelectAll()}),this._loadImages()},_loadImages:function(){var e=this,i=this.options.imagelist.IMAGES,a=this.options.imageCategory;if(e._imagesInfo={},e._setImageIndex=0,i&&i.length>0){var n=t("<ul>");if(this._imagesULContainer=n,"Library"==a)t("<li>").attr("id","addImageContainer").append(t("<div>").attr("id","addImageDiv")).append(t("<p>").text(this._getString("addpicture.label"))).appendTo(n);if(t(i).each(function(t,i){if(!(t>=e.options.count)||e.options.imageList){var a=e._createContainerAndLoadImage(i,t);n.append(a),e._imagesInfo[t]=i,e._setImageIndex++}}),n.appendTo(this.element),"Library"==a){var s=t("#addImageDiv"),o=t("<span>").addClass("ui-zfc-icon-plus-thick ui-zfc-icon").attr({id:"addImagesBtn",title:this._getString("addpicture.label")});o.on("click",function(){t("#imagelibheader #imagefile").trigger("click")}),s.append(o)}}else this._createNoImagesText();e._constructImagesList()},_createNoImagesText:function(){t("<span>").addClass("ui-lib-noimage").text(this._getString("noimagesavailable.label")).appendTo(this.element)},_createContainerAndLoadImage:function(e,i,a){e.IMAGE_NAME=e.IMAGE_NAME?this.unEscapeSingleQuote(e.IMAGE_NAME):this.unEscapeSingleQuote(e.imgName);var n=t("<img>").addClass("ui-lib-img").attr("title",e.IMAGE_NAME),s=e.src?e.src:e.IMAGE_URL,o=e.THUMBNAIL_IMAGE_URL?e.THUMBNAIL_IMAGE_URL:e.MEDIUM_IMAGE_URL;e.IMAGE_NAME?e.IMAGE_NAME:e.imgName;if("Library"==this.options.imageCategory&&FComponents.option("clientTokenIsEnabled")){var l=FComponents.option("clientTokenServiceParamName")+"="+FComponents.option("serviceName");o+=-1===o.indexOf("?")?"?":"&",o+=l}n.attr("src",o||s),e.clipartClass&&(n=t("<span>").css({display:"inline-block"})).addClass(e.clipartClass);var c=t("<li>").attr({id:this.options.imageCategory+"image"+i,"data-rid":e.RESOURCE_ID||e.IMAGE_ID,class:"ui-corner-all"}).data("infoIndex",i).append(t('<div class="zimagelist__image">').css({height:this.options.thumbnailMaxHeight}).append(t("<span>").addClass("ui-lib-image-align-span")).append(n)).append(t("<p>")),r=t("<input>").attr("type","checkbox").attr("id",i);a&&(this.deSelectAll(),r.attr("checked",!0),c.find(".zimagelist__image").addClass("ui-state-active"),this._triggerEvent("select",e));var d=e.IMAGE_NAME?e.IMAGE_NAME.split(".")[0]:"";c.append(t("<span>").addClass("ui-lib-image-label").append(r).append(t("<label>").text(d)));var g=c.find("p");return d.length<13?g.text(d):g.text(d.slice(0,13).concat("....")),this._bindEvents(c),c},createAndPositionCloseElement:function(e){var i=t('<div class="zimagelist__options"></div>');if(FCImageLibrary.downloadURL&&void 0!==FCImageLibrary.downloadURL&&void 0!==e.data("rid")){var a=FCImageLibrary.downloadURL.replace("{0}",e.data("rid"));t('<a href="'+a+'"><span title="'+FCUtil.getString("download.label")+'" class="ui-icon ui-fcomponents-icon ui-lib-image-download"></span></a>').appendTo(i)}var n=t("<span>").attr({title:this._getString("delete.label"),class:"ui-icon ui-fcomponents-icon ui-lib-image-close"}).appendTo(i);i.appendTo(e),this.positionClosebutton(e);var s=this;n.on("click",function(t){e.data("position",!0),s.deSelectAll(),e.find("img").trigger("click"),s.options.deleteAction()})},positionClosebutton:function(e){(e=e&&e.length?e:this.element.find("ul li")).each(function(e,i){var a=t(i).find(".zimagelist__options"),n=t(i).find("img"),s=n.parent(),o=n.offset().top-s.offset().top-12,l=s.offset().left+s.outerWidth(!0)-(n.offset().left+n.outerWidth(!0))+5;a.css({top:o+"px",right:l+"px"})})},_bindEvents:function(e){var i=this,a=e.find("img"),n=e.find(".zimagelist__image");a.hover(function(){if(i._isDisabled(e)||n.hasClass("ui-state-active"))return!1;n.addClass("ui-state-hover")},function(){if(i._isDisabled(e))return!1;n.removeClass("ui-state-hover")}).on("click dblclick",function(a){if(i._isDisabled(e))return!1;if(!("click"==a.type?!i._ctrlKey:i._ctrlKey)&&i.options.multiselect||(n.removeClass("ui-state-active"),e.parent().find("div").removeClass("ui-state-active"),e.parent().find("input").prop("checked",!1),e.parent().find(".zimagelist__options").fadeOut("slow").remove()),!t(a.target).parent().is("label")&&!t(a.target).is("input")){var s=!e.find("input").is(":checked");s="click"!=a.type||s,e.find("input").prop("checked",s)}if(n.hasClass("ui-state-active")&&"click"==a.type)n.removeClass("ui-state-active"),e.find(".zimagelist__options").fadeOut("fast");else if(e.find("input").prop("checked")){n.addClass("ui-state-active"),n.removeClass("ui-state-hover");var o=e.data("infoIndex");e.find(".zimagelist__options").length?e.find(".zimagelist__options").fadeIn("fast"):"click"==a.type&&i.options.deleteAction&&i.createAndPositionCloseElement(e),i._triggerEvent("click"!=a.type?"imageinsert":"select",i._imagesInfo[o])}if(void 0!==i.options.noOfImagesToBeSelected){var l=i._imagesULContainer.find("input:checked");if(l.length>i.options.noOfImagesToBeSelected){var c=t(l[0]).parent().parent();c.find(".zimagelist__image").removeClass("ui-state-active"),c.find("div").removeClass("ui-state-active"),c.find("input").removeAttr("checked"),c.find(".zimagelist__options").fadeOut("slow").remove()}}if(t.ZImageLibrary.Public.Flickr.allowCC&&"PublicFlickr"==i.options.imageCategory){var r=t("#imagelibrary").parent().parent();t.isEmptyObject(i.getSelectedImages())?(t("#licenseMsg",r).show(),t("#flickrLicenseMsg",r).hide()):(t("#licenseMsg",r).hide(),t("#flickrLicenseMsg",r).show())}})},_selectImages:function(e){var i=this;t(e).each(function(e,a){t(a).attr("checked",!0),i._ctrl=!0,t(a).closest("li").find("img").trigger("click")})},getImageDim:function(e){var i=t("<img src="+e+' style="display:none;">');t("body").append(i);var a={width:i.width(),height:i.height()};return i.remove(),a},getImagesInfo:function(){return this._imagesInfo},_constructImagesList:function(){var e={IMAGES:[]};return t.each(this._imagesInfo,function(t,i){e.IMAGES.push(i)}),this._imagesList=e,e},updateImagesList:function(e,t){var i=this._imagesList.IMAGES.length;this._imagesList&&i&&(t?this._imagesList.IMAGES.splice(0,0,e):this._imagesList.IMAGES.splice(i,0,e))},deleteImagesList:function(e){var i=this;t.each(e.imageIds,function(e,t){i.deleteList(t)})},deleteList:function(e){var i=this,a=i._imagesList?i._imagesList.IMAGES:void 0;a&&t.each(a,function(t,a){if(e===(a.RESOURCE_ID||a.IMAGE_ID))return i._imagesList.IMAGES.splice(t,1),!1})},getImagesList:function(){return this._imagesList},_getInfoLength:function(e){var a=0;for(i in e)a++;return t.isEmptyObject(e)&&(a=0),a},updateImagelist:function(e){var i=this,a=e.IMAGES,n=this.element.find("ul");t(a).each(function(e,t){if(!(e>=i.options.count)||i.options.imageList){var a=i._createContainerAndLoadImage(t,i._setImageIndex);n.append(a),i._imagesInfo[i._setImageIndex]=t,i.updateImagesList(t),i._setImageIndex++}})},addImage:function(e){var t=this._setImageIndex,i=this.element.find("ul").children("li:first");this._imagesInfo[""+t]=e,this.updateImagesList(e,!0),e instanceof Array&&(e=e[0]);var a=this._createContainerAndLoadImage(e,t,!0);i.length?a.insertAfter(i):this.element.find("ul").append(a),this._setImageIndex++},_triggerEvent:function(e,t){var i={info:t};return this._dispatchEvent(e,e,i)},getSelectedImages:function(){var e=this,i=this.element.find("input:checked"),a=[];return t(i).each(function(i,n){var s=parseInt(t(n).attr("id")),o=e._imagesInfo[s];o&&a.push(o)}),a},selectAll:function(){var e=this.element.find("input[type=checkbox]");t(e).each(function(e,i){t(i).attr("checked",!0),t(i).closest("li").find(".zimagelist__image").addClass("ui-state-active")}),this._triggerEvent("selectall",this._imagesInfo)},deSelectAll:function(){var e=this.element.find("input[type=checkbox]");t(e).each(function(e,i){t(i).attr("checked",!1),t(i).closest("li").find(".zimagelist__image").removeClass("ui-state-active"),t(i).closest("li").find(".zimagelist__options").hide()}),this._triggerEvent("unselectall",this._imagesInfo)},removeAllCloseButtons:function(){this.element.find(".zimagelist__options").remove()},removeSelectedImages:function(e){var i=this.element.find("input:checked"),a=this,n=t(i[0]).closest("li").prev().index();t(i).each(function(e,i){var n=t(i).closest("li");delete a._imagesInfo[n.data("infoIndex")],n.index(),n.fadeOut(200,function(){n.remove()}),t("body").find(".ui-ztooltip").remove()}),a.deleteImagesList(e),setTimeout(function(){var e=a._selectNextImage(n+1);2===e&&2===(e=a._selectNextImage(n-1))&&(e=a._selectNextImage(1))},650)},_selectNextImage:function(e){var i=this.element.find("ul > li");if(i.length>0){var a=t(i[e])&&t(i[e]).length?t(i[e]):t(i[e-1]);return a?(a.find("img").trigger("click"),1):2}return 0},removeImage:function(e){var i="string"==typeof e?this.element.find("#"+e):t(e);i.length&&i.closest("li").remove()},removeImages:function(e){t(e).each(function(e,t){this.removeImage(t)})},refresh:function(){this.getImages(this._startIndex)},disableSelected:function(){var e=this.element.find("input:checked");t(e).each(function(e,i){t(i).closest("li").attr("disabled",!0).addClass("ui-state-disabled")})},enableSelected:function(){var e=this.element.find("input:checked");t(e).each(function(e,i){t(i).closest("li").removeAttr("disabled").removeClass("ui-state-disabled")})},_isDisabled:function(e){return!!e.attr("disabled")},_getString:function(e,t,i){return FCUtil.getI18NString(i||"zimagelibrary",e,t||void 0,this.options.keys)},unEscapeSingleQuote:function(e){return e&&(e=e.replace(/&#39;/g,"'")),e}};e.registerComponent("ZImageList",e.CoreComponent,{}),e.registerComponent("ZImageList",e.ZImageList,a),e.ZImageList.defaults={noOfImagesToBeSelected:void 0,count:10,multiselect:!1,imagelist:void 0,keys:{"noimagesavailable.label":"No Images Available"},deleteAction:void 0,thumbnailMaxHeight:160}}(ZComponents,ZComponents.DOMUtil);!function(t,e){var a={CLASSES:{},_urlCheck:/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,_EVENTS:["ondrop","onuploadfailed"],_create:function(){this._bindEvents()},_bindEvents:function(){var e=this,a=this.name;t("#zdragdropupload").remove(),this._overlay=null,this.element.off("dragover."+a+" drop."+a).on("dragover."+a,function(a){e._overlay||(e._overlay=t("<div id='zdragdropupload' style='z-index:1000000000000;opacity:0;width:100%;height:100%;position:absolute;left:0;right:0;top:0;bottom:0;background:transparent;'><div>").appendTo("body")),a.preventDefault()}).on("drop."+a,function(a){e._overlay&&e._overlay.remove(),e._overlay=null,a.preventDefault();var r=t(".zdialog:visible"),o=!1;r.length?r.find("#"+e._opts.imagelibraryDialog).length&&(o=!0,e._triggerEvent("ondrop",t(a.target),o)):e._triggerEvent("ondrop",t(a.target),o);e.upload(a)})},_triggerEvent:function(t,e,a){var r={target:e,droppedOnLibrary:a};return this._dispatchEvent(t,t,r)},upload:function(t,e){var a=this._uploadFiles(t.originalEvent,e),r=this._opts.callbacks.drop;r&&r(t,a)},_uploadFiles:function(t,e){if(t.dataTransfer&&t.dataTransfer.files){var a=t.dataTransfer.files,r=[];return r.push(this._upload(a,t,e)),r}},_upload:function(e,a){var r=this._opts,o=(r.addToDoc,r.callbacks.beforeUpload);if(o&&!o(e,a))return this._triggerEvent("onuploadfailed",t(a.target)),a.preventDefault(),void a.stopPropagation();var n=t.extend({},r.data);this._replacePrams(e,n,a);var i=r.callbacks.success;return i&&(r.callbacks.success=function(t){i(t,n.add_lib)}),t.ajaxUpload(r.url,n,r.callbacks,"text")},_getFileName:function(t){var e=t.substr(t.lastIndexOf("/")+1);return-1!==t.indexOf("/")&&""===e&&(e=(t=t.substring(0,t.length-1)).substr(t.lastIndexOf("/")+1)),e},destroy:function(){t("#zdragdropupload").remove(),this._overlay=null,this.element.off("."+this.name)},_replacePrams:function(e,a,r){var o=this;t.each(a,function(n,i){var l=void 0;if("$DATAURI"===i||"$URL"===i||"$FILE"===i){var s=t(r.dataTransfer.getData("text/html"));if("$FILE"==i&&e.length?l=e:"$DATAURI"!=i&&"$URL"!=i||s.length&&(l=t(s[s.length-1]).attr("src"),"$URL"!==i||o._urlCheck.test(l)?"$DATAURI"===i&&o._urlCheck.test(l)&&(l=void 0):l=void 0),l&&void 0!==l){if("$DATAURI"===i){var d=t(s[s.length-1]);l="####"+o._getFileName(d.attr("title")||d.attr("alt"))+"####"+l}a[n]=l}else delete a[n]}else l=i,"$FILESIZE"===i?l=file.fileSize:"$FILENAME"===i&&(l=file.name),a[n]=l})}};e.registerComponent("ZDragDropUpload",e.CoreComponent,{}),e.registerComponent("ZDragDropUpload",e.ZDragDropUpload,a)}(jQuery,ZComponents);!function(e){e.FCDragDropImage={_supportedFormats:"jpg,png,gif,jpeg,bmp",init:function(e,a){this.initDragDropUpload(e,FCImageLibrary.getCustomData("upload",!0))},initDragDropUpload:function(a,r){var i=this,o={beforeUpload:function(e){return i.dropMethod(e)},progress:function(a,r){var i=e("#imagelibrary");i.length&&e(i).is(":visible")&&i.zimagehandler("updateUploadProgressbar",r)},addImage:function(a,r){var i=a;a&&a.IMAGES&&(i=a.IMAGES),i instanceof Array||(i=[i]);var o=e("#imagelibrary");o.length&&e(o).is(":visible")?o.zimagehandler("insert",i,r):e(document).trigger("imageinsert",{info:i,insertFrom:"local",isInsertFromWeb:!1,addedtolib:r})},success:function(a,r){var t=a;if("object"!=typeof t&&(t=e.parseJSON(a)),"object"==typeof t&&"success"===t.request){var d=e("#imagelibrary");if(d.length&&e(d).is(":visible"))if("local"!=d.zimagehandler("getSelectedImageCategory")){var n=t;t&&t.IMAGES&&(n=t.IMAGES),n instanceof Array||(n=[n]);for(var l=0;l<n.length;l++)d.zimagehandler("addImage",n[l])}else o.addImage(t,r);else o.addImage(t,r)}else i._handleUploadFail(t)},fail:function(e){i._handleUploadFail(e)}},t={imagefile:"$FILE",imageuri:"$DATAURI",importurl:"$URL"};a?e.extend(!0,t,r):(t.sourcetype="document",t.add_lib="true",t[FComponents.option("csrfParamName")]=FCUtil.getCSRFToken()),e("body").zdragdropupload({url:FCImageLibrary.getUploadURL(),data:t,callbacks:o,imagelibraryDialog:"imagelibrary"}).on("dragdropuploadondrop.FCDragDropImage",function(a,r){e("body").zdragdropupload("setAttribute","addToDoc",r.droppedOnLibrary?"false":"true")})},_handleUploadFail:function(a){var r=e("#imagelibrary");r.zimagehandler("showError",a);var i=r.zimagehandler("getSelectedImageCategory");if("Library"==i){var o=e("#"+i+"Images").find(".ui-lib-image-loader-container");e(o[o.length-1]).parent("li").remove()}},dropMethod:function(a){if(a.length&&!e.ZImageAction.validateFiles(a))return!1;var r=e("#imagelibrary");if(!r.length||!e(r).is(":visible"))return!0;var i=!1,o=r.zimagehandler("getSelectedImageCategory");if("Library"==o||"local"==o){i=!0,r.zimagehandler("showProgressBar");var t=0;e("#"+o+"Images").length||e("#imagelibheader","#imagelibrary").show(),e.each(a,function(r,i){var d=e("<div>").addClass("ui-lib-image-loader-container");e("<span>").addClass("ui-lib-loader ui-lib-image-loader").appendTo(d);var n=e("#"+o+"Images").find("#addImageContainer");d.insertAfter(n),function(){if(++t==a.length){var r=e("body").zdragdropupload("getAttribute","callbacks"),i=r.success;r.success=function(a,r){var t=e("#"+o+"Images").find(".ui-lib-image-loader-container"),d=e(t[t.length-1]).parent("li");d.css({width:d.width(),height:d.height()}),t.remove(),i(a,r,d)},e("body").zdragdropupload("setAttribute","callbacks",r)}}()})}return i},destroy:function(){e("body").zdragdropupload("destroy"),e("body").off("dragdropuploadondrop.FCDragDropImage")},imageErrorResp:function(a){respText=a.replace(/'/g,'"'),"object"!=typeof respText&&(responseObj=e.parseJSON(respText)),respText&&respText.errorMsg&&alert(respText.errorMsg)}}}(jQuery);