var DRE={initComplete:false};DRE.Constants={baseUrl:"https://dre.zoho.eu",staticUrl:{js:"https://js.zohostatic.eu/dre",css:"https://js.zohostatic.eu/dre"},buildLabel:"master_Jan_13_2020"};var DREInjector={};var DREInitializer={};(function(a){var b={};b.externalServices={clockworksms:["sms"],google:["drive"],hoiio:["sms"],clickatell:["sms"],screenmagic:["sms"],twilio:["sms"]};b.defaultZohoServices=["calendar","reports","creator","projects","desk","crm","cliq","salesiq","recruit","encryption","sheet","docs","workdrive","writer"];b.defaultTaskRestrictions={zoho:{crm:["_businessCardView","_slashCommands","_attachFile","__create","mailMerge","getTemplates","getMergedFile","v1"],cliq:["postToChatAsAdmin","postToChannelAsAdmin","postToBotAsAdmin"],chat:["postToChatAsAdmin","postToChannelAsAdmin"],connect:["addStream"],invoice:["searchRecords"],recruit:["uploadDocument","uploadFile"],calendar:["v1"]}};b.getDomainBasedZohoServices=function(d){var d=d||DelugeUtil.getDomain();var c=b.defaultZohoServices;switch(d){case"skydesk":break;case"cn":c.push("mail","connect","people","ai","notebook");break;case"eu":c.push("mail","connect","books","invoice","inventory","subscriptions","sdp","people","ai","map","sign","notebook");break;case"in":default:c.push("mail","connect","books","invoice","inventory","subscriptions","sdp","people","ai","map","sign","notebook","bookings");break}return{zoho:c}};b.getDomainBasedTasksRestrictions=function(){var c=c||DelugeUtil.getDomain();switch(c){case"skydesk":return{zoho:{crm:["invokeConnector","getOrgVariable"]}}}return b.defaultTaskRestrictions};if(!a.hasOwnProperty("config")){a.config={}}a.config.integrationTasks=b;a.config.systemFields={restrictions:["appuri","appname"]}})(DRE);(function(a){var b=function(){};b.prototype={require:function(c,g,f,e){this.loadCount=0;this.totalRequired=c.length;this.callback=g;e=e!=null?e:true;for(var d=0;d<c.length;d++){if(f){this.writeScript(c[d],e)}else{this.writeStyle(c[d],e)}}},loaded:function(c){this.loadCount++;if(this.loadCount==this.totalRequired&&typeof this.callback=="function"){this.callback.call()}},writeScript:function(g,f){var c=this;var e=document.createElement("script");e.type="text/javascript";e.async=f;e.src=g;if(e.addEventListener){e.addEventListener("load",function(h){c.loaded(h)},false)}else{if(e.attachEvent){e.attachEvent("onload",function(h){c.loaded(h)})}}var d=document.getElementsByTagName("head")[0];if(e!=null){d.appendChild(e)}},writeStyle:function(g,f){var c=this;var e=document.createElement("link");e.rel="stylesheet";e.type="text/css";e.href=g;e.async=f;if(e.addEventListener){e.addEventListener("load",function(h){c.loaded(h)},false)}else{if(e.attachEvent){if(document.createStyleSheet){document.createStyleSheet(e.href)}}}var d=document.getElementsByTagName("head")[0];d.appendChild(e)}};a.Loader=b})(DRE);DRE.Constants.Editor={urls:{parentCss:[DRE.Constants.staticUrl.css+"/"+DRE.Constants.buildLabel+"/css/codemirror.css"],css:[DRE.Constants.staticUrl.css+"/"+DRE.Constants.buildLabel+"/css/dre.css"],parentJS:[DRE.Constants.staticUrl.js+"/"+DRE.Constants.buildLabel+"/js/codemirror.js"],js:[DRE.Constants.staticUrl.js+"/"+DRE.Constants.buildLabel+"/js/dre.js"],addons:{js:[DRE.Constants.baseUrl+"/js/codemirror_addons_aio.js"],css:[DRE.Constants.baseUrl+"/css/codemirror_addons_aio.css"]}}};DRE.Constants.Editor.i18n = {"deluge.editor.shortcuts.undo":"Undo","deluge.editor.menu.help":"Help","deluge.editor.shortcuts.blockcomment.toggle":"Toggle Block Comment","deluge.editor.buttons.executescript":"Execute Script","deluge.editor.menu.help.guide":"Guide","deluge.editor.shortcuts.hint.next":"Go to next hint tag","deluge.editor.buttons.saveandexecutescript":"Save & Execute Script","deluge.editor.menu.help.support":"Support","deluge.editor.shortcuts.findandreplace":"Find & Replace","deluge.editor.leftpane.tasks.groupname.collection":"Collection","deluge.editor.shortcuts.title":"Keyboard Shortcuts","deluge.editor.leftpane.tasks.groupname.datawithinzoho":"Data Within Zoho","deluge.editor.shortcuts.script.execute":"Execute Script","deluge.editor.shortcuts.childvariables":"Show functions / child variables","deluge.editor.leftpane.tasks.groupname.clientfunctions":"Client functions","deluge.editor.shortcuts.redo":"Redo","deluge.editor.leftpane.tasks.groupname.mapmanipulation":"Map manipulation","deluge.editor.shortcuts.showhint":"Show Hint","deluge.editor.buttons.savescript":"Save Script","deluge.editor.shortcuts.find":"Find","deluge.editor.leftpane.tasks.groupname.notifications":"Notifications","deluge.editor.shortcuts.gotoline":"Go to line","deluge.editor.leftpane.tasks.groupname.listmanipulation":"List manipulation","deluge.editor.shortcuts.comment.toggle":"Toggle Comment","deluge.editor.leftpane.tasks.groupname.basic":"Basic","deluge.editor.leftpane.tasks.groupname.xmlmanipulation":"Xml manipulation","deluge.editor.leftpane.tasks.groupname.debugandbranching":"Debug & Branching","deluge.editor.delugetasks.title":"Deluge Tasks","deluge.editor.shortcuts.hint.previous":"Go to previous hint tag","deluge.editor.leftpane.tasks.groupname.condition":"Condition","deluge.editor.shortcuts.script.save":"Save Script","deluge.editor.leftpane.tasks.groupname.integrations":"Integrations","deluge.editor.shortcuts.script.saveandexecute":"Save and Execute Script","deluge.editor.shortcuts.showfunctiondefinition":"Show Function Definition"};(function(b){var a={isEditorLoaded:false,isStaticInclusionStarted:false};a.isCodeMirrorExists=function(){return(typeof(CodeMirror)!="undefined")};a.isDelugeEditorExists=function(){return(typeof(DelugeEditorWrapper)!="undefined")};a.checkForJsFiles=function(){return this.isCodeMirrorExists()&&this.isDelugeEditorExists()};a.postAction=function(){b.initComplete=true;this.isEditorLoaded=true};if(!b.Injector){b.Injector={}}b.Injector.Editor=a})(DRE);(function(a){var b=a.Constants;var d=b.Editor.urls;var f=a.Injector.Editor;var c=b.Editor.urls.addons;function e(){if(!f.checkForJsFiles()){var g=new a.Loader();f.isStaticInclusionStarted=true;function k(l){g.require(d.parentCss,function(){g.require(d.parentJS,function(){l()},true)},false)}function h(){g.require(d.css,function(){g.require(d.js,function(){f.postAction()},true)},false)}function j(l){g.require(c.css,function(){g.require(c.js,l,true)},false)}if(!f.isCodeMirrorExists()){k(h)}else{j(h)}}}e();a.Editor={load:e}})(DRE);(function(a){var c=function(f,o){o=o?o:{};if(a.Injector.Editor.checkForJsFiles()){var e=f?f:document.getElementById("delugeEditorArea");if(e){var g=o.hasOwnProperty("loading")&&o.loading;g&&k(o.loading,true);var h=null;if(e.querySelector("#delugeCodeArea")){delugeEditor.setOptions(o);return null}else{o.constants=DRE.Constants;h=new DelugeEditorWrapper(e,o,DRE.config);d(h);delugeEditor=h}var j=e.getAttribute("preventWarning");if(j==null||j==""){j=false}n(h);if(o&&o.hasOwnProperty("callback")){o.callback(h)}g&&k(o.loading,false);return h}}else{var m=setInterval(function(){if(a.Injector.Editor.isStaticInclusionStarted==true&&a.Injector.Editor.isEditorLoaded==true){clearInterval(m);o.hasOwnProperty("loading")&&k(o.loading,false);a.Initializer.Editor.initialize(f,o)}else{o.hasOwnProperty("loading")&&k(o.loading,true)}},700)}function n(q){if(window.attachEvent){window.attachEvent("onbeforeunload",p)}else{if(window.addEventListener){window.addEventListener("beforeunload",p)}}function p(t){var r=delugeEditor.delugeArea.className;var s=document.getElementsByClassName(r);if(s.length>0&&q.isEditorContentModified()){t.returnValue="false"}}}function d(q){var r=q.delugeArea;if(r){r.addEventListener("keydown",p,true)}function p(t){var s=t.keyCode||t.which;var u=t.ctrlKey&&!t.shiftKey&&!t.altKey&&!t.metaKey;if(u&&s==32){q.editor.execCommand("autocomplete");t.stopImmediatePropagation();t.stopPropagation();t.preventDefault()}}r.addEventListener("DOMNodeRemovedFromDocument",function(){r.removeEventListener("keyup",p,true)})}function k(q,p){if(q){if(p==true&&(!q.hasOwnProperty("shown")||q.shown==false)){q.show();q.shown=true}else{q.hide()}}}function l(q,p){jQuery.ajax({type:"POST",url:DRE.Constants.baseUrl+"/getUserSchema",data:{scopeID:q},dataType:"json",beforeSend:function(r){lockRequest=true}}).done(function(r){appCache={services:r}})}};function b(){var d=document.getElementById("delugeEditorArea");if((d&&d.getAttribute("auto-init")==="true")){c(d)}}b();if(!a.Initializer){a.Initializer={}}DRE.Initializer.Editor={initialize:c};DRE.initEditor=c})(DRE);var initializeDelugeEditor=DRE.Initializer.Editor.initialize;function changeStatus(b,a){jQuery("#newstatusmessage").css("visibility","");if(a){jQuery("#newstatusmessage").attr("class","script-status-error");jQuery("#newstatusmessage").html(b)}else{jQuery("#newstatusmessage").attr("class","script-status-success");jQuery("#newstatusmessage").html(b)}}function showSaveStatus(b){var a=JSON.parse(b);if(a){if(a.status=="success"){changeStatus("Script Saved...")}else{changeStatus(a.message,true)}}else{changeStatus("Unable to save script",true)}}function showResponse(b){var a=JSON.parse(b);jQuery("#newstatusmessage").css("visibility","");if(a){changeStatus(a.message);if(a.status=="success"){jQuery("#output-container").css("visibility","");jQuery("#output").html(a.result)}else{jQuery("#output-container").css("visibility","hidden")}}else{changeStatus("Unable to execute script",true)}}(function(a){var b=a.Constants;b.Connections={urls:{css:[b.staticUrl.css+"/"+b.buildLabel+"/css/connections.css"],js:[b.staticUrl.js+"/"+b.buildLabel+"/js/connections.js"]}};var c={injectionCompleted:false};c.inject=function(e,h,g,f){f=f||{};f.constants=b;if(!c.injectionCompleted){if(f&&f.hasOwnProperty("loading")){f.loading.shown=true;f.loading.show()}var d=new a.Loader();d.require(b.Connections.urls.css,function(){d.require(b.Connections.urls.js,function(){c.injectionCompleted=true;DREConnections.init(e,h,g,f)},true)},false)}else{DREConnections.init(e,h,g,f)}};if(!a.Injector){a.Injector={}}a.Injector.Connections=c;a.initConnections=c})(DRE);var includeDREConnections=DRE.Injector.Connections.inject;var ExecutionLogs=new function(){this.serviceName=null;this.sharedBy=null;this.initialTime=null;this.setData=function(e,d,c){if(this.initialTime==null){jQuery(".execution-log").scroll(function(f){if((jQuery(".execution-log").scrollTop()+jQuery(".execution-log").height())>=jQuery(".execution-log")[0].scrollHeight){if(processing){return false}else{ExecutionLogs.fetchExecutionLogs();return false}}})}this.serviceName=e;this.sharedBy=d;this.initialTime=c};processing=false;var b=false;this.fetchExecutionLogs=function(){var c=DRE.Constants.baseUrl;if(!b){processing=true;a(true);jQuery.ajax({url:c+"/dre/executionLogs",type:"POST",async:"true",data:{serviceName:this.serviceName,sharedBy:this.sharedBy,initialTime:this.initialTime},success:function(e){var d=jQuery(".execution-log");if(e&&e.length>16){d.append(e)}else{b=true}a(false);processing=false}})}};function a(c){var d=jQuery("#executionLogsLoading");var e=jQuery(".execution-log");if(c){e.append(d);d.show()}else{d.hide();jQuery(".dre-execution-logs").append(d)}}};var dreVersion=(function(){function b(k,h,j){var g=k.delugeArea;var m=document.createElement("div");m.setAttribute("class","dre-test-popup");var l=document.createElement("div");l.setAttribute("class","dre-popup-freeze");var n={sharedBy:h,functionID:k.functionId,serviceName:j};m.innerHTML="<div class='dre-version dre-version-loading'><div class='version-header'><span class='dre-v-header-msg'>Version History</span><span class='dre-v-close'></span></div> <div class='no-version-msg'><div class='version-msg'>Loading...</div></div> </div>";g.appendChild(l);document.getElementById("delugeEditorArea").appendChild(m);m.querySelector(".dre-v-close").addEventListener("click",function(){a()});ajaxCall(DRE.Constants.baseUrl+"/deluge/versions","GET",n,f,true,true);function f(s){var r=document.querySelector(".dre-test-popup");if(r){r.innerHTML=s;var q=r.querySelector("#latestVersionScript");if(q){var p=document.getElementById("versionScript");e(p,q.innerText);q.parentElement.removeChild(q)}var o=r.querySelectorAll(".dre-version .version-list .version");o.forEach(function(t){t.addEventListener("click",function(){var u=r.querySelector(".dre-version .version-list .version.active");if(u!=null){u.className="version"}t.className="version active";c(h,t.getAttribute("fid"),t.getAttribute("version"))})});r.querySelector(".dre-v-close").addEventListener("click",function(){a()})}}}function d(f){document.addEventListener("keydown",function(k){var j=k.which||k.keyCode;if(j==27){var g=f;if(g){var h=g.querySelector(".dre-test-popup");if(h){a()}}}})}function c(j,f,h){var k=document.getElementById("versionScript");var l={sharedBy:j,functionID:f,version:h};var g=DRE.Constants.baseUrl;ajaxCall(g+"/versionScript","GET",l,function(m){e(k,m)},true,true)}function e(g,h){h=h.substr(h.indexOf("{")+2);h=h.substr(0,h.lastIndexOf("}"));var f=DelugeUtil.renderScript(h);g.innerHTML=f.outerHTML+"<div class='dre-v-replace'><input type='button' id='dreVReplace' class='dre-v-button' value='Replace With this'/></div><textarea id='dreVReplaceScript' style='display:none;'>"+h+"</textarea>";CodeMirror.runMode(h,"text/deluge",g.querySelector("pre"));g.querySelector("#dreVReplace").addEventListener("click",function(){delugeEditor.setEditorContent(g.querySelector("#dreVReplaceScript").value);a()})}function a(){var g=document.querySelector(".dre-test-popup");var f=document.querySelector(".dre-popup-freeze");if(g&&f){g.parentElement.removeChild(g);f.parentElement.removeChild(f)}}return{trigger:b,bindDocumentEvent:d}})();var DREGalleryFunction=function(){var l=null;var d="";var j=null;var c="";var f=null;var p=null;var q=null;var m={};var k=[];var o=null;this.showMessageBox=function(t,r,w){if(l==null){l=JSON.parse(document.getElementById("responseJson").value);j=l.functionsList;d=l.domainName;o=document.getElementById("dreContainer");f=o.querySelector("#dreMessageBox");p=document.getElementById("blackOverlay");var v=document;if(typeof v.addEventListener!="undefined"){v.addEventListener("keydown",function(C){if(C.keyCode==27){e()}},false)}else{if(typeof v.attachEvent!="undefined"){v.attachEvent("onkeydown",function(C){if(C.keyCode==27){e()}})}}finishElem=f.querySelector("#finishInstallBtn");finishElem.addEventListener("click",function(){var E=(JSON.parse(JSON.stringify(j[c])));E.galleryFunctionId=c;for(var D in k){if(k.hasOwnProperty(D)){var C=k[D];E.params[D].value=f.querySelector("#dre-g-arg-"+C).value}}E.moduleName=f.querySelector("#dreAddFunctionModule").value;galleryFunction.install(E);e()});moduleDiv=f.querySelector("#dreAddFunctionModule");moduleDiv.addEventListener("change",function(){n()});closeElem=f.querySelectorAll(".gbutton-inputs .cancel");for(i=0;i<closeElem.length;++i){closeElem[i].addEventListener("click",e)}}var s=false;var y=f.querySelector("#dreFunctionDetails");var u=f.querySelector("#dreAddFunctionFormDiv");if(y.style.display=="block"){s=true;y.className+=" animate-dre-function-desc";setTimeout(function(){y.style.display="none";y.className="brief-gfunction-desc g-row g-clear"},200)}if(u.style.display=="block"){u.className="gfunction-form";setTimeout(function(){u.style.display="none"},200)}if(r!=null){c=r}functionDetails=j[c];if(q&&q.hasOwnProperty("skipModuleAndArguments")&&q.skipModuleAndArguments){t="desc"}if(t=="desc"){y.querySelector("#dreFunctionTitle").textContent=functionDetails.displayName;y.querySelector("#dreFunctionDesc").textContent=functionDetails.description;y.querySelector("#addFuncNextBtn").value="Next";var A=functionDetails.logoUrl;A=d+(A!=null?A:"/svg/code.svg");if(w){y.querySelector("#addFuncNextBtn").setAttribute("onclick","galleryFunction.showMessageBox('addFunc',"+c+",true)")}else{y.querySelector("#addFuncNextBtn").setAttribute("onclick","galleryFunction.showMessageBox('addFunc')")}y.querySelector("#dreFunctionDescImage").innerHTML='<img src="'+A+'" />';if(w){y.className+=" animate-dre-function-desc";setTimeout(function(){y.style.display="block";y.className="brief-gfunction-desc g-row g-clear"},200)}else{k=[];y.style.display="block"}if(q&&q.hasOwnProperty("skipModuleAndArguments")&&q.skipModuleAndArguments){y.querySelector("#addFuncNextBtn").value="Finish";y.querySelector("#addFuncNextBtn").setAttribute("onclick","galleryFunction.install()")}}else{if(t=="addFunc"){if(typeof(w)=="undefined"){u.querySelector("#dreAddFunctionTitle").textContent=functionDetails.displayName;var x=u.querySelector("#showDescription");x.setAttribute("onclick","galleryFunction.showMessageBox('desc',"+c+",true)");var z=functionDetails.params;if(z&&z.length>0){var B=g(z);u.querySelector("#dreAddFunctionArgs").innerHTML=B;u.querySelector(".g-arguments").style.display="block"}else{u.querySelector(".g-arguments").style.display="none"}b()}if(s){u.style.display="block";setTimeout(function(){u.className+=" animate-dre-add-function"},200)}else{u.className+=" animate-dre-add-function";u.style.display="block"}}}f.style.display="block";setTimeout(function(){f.className="animate-msg-box"},100);p.style.display="block";setTimeout(function(){if(t=="desc"){y.querySelector("#addFuncNextBtn").focus()}else{if(t=="addFunc"){u.querySelector("#dreAddFunctionModule").focus()}}},200);a(y,u)};this.setModuleList=function(t){m={};for(var v in t){if(t.hasOwnProperty(v)){var u=t[v];var s={};for(var r in u){if(u.hasOwnProperty(r)){s[r]=u[r]}}m[u.moduleName]=s}}};this.refresh=function(){l=null};var n=function(){if(q&&q.hasOwnProperty("skipArguments")&&q.skipArguments){return}var s=o.querySelector("#dreAddFunctionModule").value;var r=m[s];if(r){var t=r.fields;if(!t){t=typeof(this.moduleOnChangeEvent)=="function"&&this.moduleOnChangeEvent(r,this.createFieldsOption)}else{h(t)}}};var h=function(v){var x="";x="<option/>Select Field</option>";if(v&&v!=null){for(var u in v){if(v.hasOwnProperty(u)){var z=v[u];if(z.hasOwnProperty("groupName")&&z.hasOwnProperty("fields")){var y=z.groupName;var w=z.fields;x+='<optgroup label="'+y+'">';for(var s in w){if(w.hasOwnProperty(s)){var t=w[s];x+='<option value="'+t.fieldName+'"/>'+t.displayName+"</option>"}}x+="</optgroup>"}else{if(z.hasOwnProperty("fieldName")&&z.hasOwnProperty("displayName")){x+='<option value="'+z.fieldName+'"/>'+z.displayName+"</option>"}}}}}for(var u in k){if(k.hasOwnProperty(u)){var r=k[u];var A=o.querySelector("#dre-g-arg-"+r);A.innerHTML=x}}};function b(){if(m){var v=m;var t=Object.keys(v).length;var u="",w=o.querySelector("#dreAddFunctionModule");u="<option/>Select Module</option>";for(var s in v){if(v.hasOwnProperty(s)){var r=v[s];u+='<option value="'+s+'"/>'+r.displayName+"</option>"}}w.innerHTML="";w.innerHTML=u}}function g(r){var s="";k=[];for(var t in r){if(r.hasOwnProperty(t)){var u=r[t];k.push(u.name);s+='<div class=" arg-inputs g-row g-clear "><div class="label-div g-col-1-2"><label >'+u.name+' </label></div><div class="g-col-1-2"><div class="g-dropdown"><select id="dre-g-arg-'+u.name+'"><option>Select Field</option></select>  </div></div></div>'}}return s}var e=function(){f.className="";setTimeout(function(){o.querySelector("#dreFunctionDetails").setAttribute("style","display:none");o.querySelector("#dreAddFunctionFormDiv").setAttribute("style","display:none");f.setAttribute("style","display:none");p.setAttribute("style","display:none");o.querySelector("#dreAddFunctionFormDiv").setAttribute("class","gfunction-form");o.querySelector("#dreFunctionDetails").setAttribute("class","brief-gfunction-desc g-row g-clear")},250)};this.setOptions=function(r){q=r};function a(u,t){if(q){if(q.hasOwnProperty("skipModule")&&q.skipModule){var s=t.querySelector(".dre-g-module");s.style.display="none";if(q.hasOwnProperty("moduleName")&&q.moduleName){t.querySelector("#dreAddFunctionModule").value=q.moduleName}n()}else{if(q.hasOwnProperty("skipArguments")&&q.skipArguments){var r=t.querySelector(".dre-g-arguments");r.style.display="none"}}}}};var galleryFunction=new DREGalleryFunction();